<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.58" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://aiyin5.github.io/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E6%89%98%E7%AE%A1%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html"><meta property="og:site_name" content="è‰¾å› çš„åšå®¢"><meta property="og:title" content="åŸºç¡€æ¨¡å¼ æ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸ"><meta property="og:description" content="åŸºç¡€æ¨¡å¼ æ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸ 2.4 Managed Lifecycle &nbsp;æ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸ Containerized applications managed by cloud-native platforms have no control over their lifecycle, and to be good cloud-native citizens, they have to listen to the events emitted by the managing platform and adapt their lifecycles accordingly. The Managed Lifecycle pattern describes how applications can and should react to these lifecycle events."><meta property="og:type" content="article"><meta property="og:updated_time" content="2023-01-12T05:00:13.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:tag" content="ç¿»è¯‘"><meta property="article:published_time" content="2023-01-05T00:00:00.000Z"><meta property="article:modified_time" content="2023-01-12T05:00:13.000Z"><title>åŸºç¡€æ¨¡å¼ æ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸ | è‰¾å› çš„åšå®¢</title><meta name="description" content="åŸºç¡€æ¨¡å¼ æ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸ 2.4 Managed Lifecycle &nbsp;æ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸ Containerized applications managed by cloud-native platforms have no control over their lifecycle, and to be good cloud-native citizens, they have to listen to the events emitted by the managing platform and adapt their lifecycles accordingly. The Managed Lifecycle pattern describes how applications can and should react to these lifecycle events.">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-8a9a9b01.css" as="style"><link rel="stylesheet" href="/assets/style-8a9a9b01.css">
    <link rel="modulepreload" href="/assets/app-29be8814.js"><link rel="modulepreload" href="/assets/framework-e28fa486.js"><link rel="modulepreload" href="/assets/æ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸ.html-8c5f921c.js"><link rel="modulepreload" href="/assets/æ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸ.html-114130ec.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/rabbitMan.jpg" alt="è‰¾å› çš„åšå®¢"><!----><span class="site-name hide-in-pad">è‰¾å› çš„åšå®¢</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><!----><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="ä¸»é¡µ"><span class="icon iconfont icon-home"></span>ä¸»é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="è‰¾å› çš„ä¸–ç•Œ"><span class="title"><span class="icon iconfont icon-discover"></span>è‰¾å› çš„ä¸–ç•Œ</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E8%89%BE%E5%9B%A0/%E5%85%B3%E4%BA%8E%E8%89%BE%E5%9B%A0.html" class="nav-link" aria-label="å…³äºè‰¾å› "><span class="icon iconfont icon-edit"></span>å…³äºè‰¾å› <!----></a></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>ç”Ÿæ´»ä½“éªŒ</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E8%89%BE%E5%9B%A0/%E7%94%9F%E6%B4%BB%E4%BD%93%E9%AA%8C/%E4%B8%8A%E6%B5%B7.html" class="nav-link" aria-label="ä¸Šæµ·"><span class="icon iconfont icon-edit"></span>ä¸Šæµ·<!----></a></li><li class="dropdown-subitem"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E8%89%BE%E5%9B%A0/%E7%94%9F%E6%B4%BB%E4%BD%93%E9%AA%8C/%E6%9D%AD%E5%B7%9E.html" class="nav-link" aria-label="æ­å·"><span class="icon iconfont icon-edit"></span>æ­å·<!----></a></li><li class="dropdown-subitem"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E8%89%BE%E5%9B%A0/%E7%94%9F%E6%B4%BB%E4%BD%93%E9%AA%8C/%E5%AE%89%E5%90%89.html" class="nav-link" aria-label="å®‰å‰"><span class="icon iconfont icon-edit"></span>å®‰å‰<!----></a></li><li class="dropdown-subitem"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E8%89%BE%E5%9B%A0/%E7%94%9F%E6%B4%BB%E4%BD%93%E9%AA%8C/%E5%A4%A7%E7%90%86.html" class="nav-link" aria-label="å¤§ç†"><span class="icon iconfont icon-edit"></span>å¤§ç†<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>å…³äºå¨å¸ˆ</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E8%89%BE%E5%9B%A0/%E5%85%B3%E4%BA%8E%E5%8E%A8%E5%B8%88/%E8%89%BE%E5%9B%A0%E5%AE%B6%E7%9A%84%E8%8F%9C%E8%B0%B1.html" class="nav-link" aria-label="è‰¾å› å®¶çš„èœè°±"><span class="icon iconfont icon-edit"></span>è‰¾å› å®¶çš„èœè°±<!----></a></li><li class="dropdown-subitem"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E8%89%BE%E5%9B%A0/%E5%85%B3%E4%BA%8E%E5%8E%A8%E5%B8%88/%E8%89%BE%E5%9B%A0%E5%AE%B6%E7%9A%84%E7%94%9C%E5%93%81.html" class="nav-link" aria-label="è‰¾å› å®¶çš„ç”œå“"><span class="icon iconfont icon-edit"></span>è‰¾å› å®¶çš„ç”œå“<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>è§†é‡</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/zh/posts/å…³äºè‰¾å› /è§†é‡/1" class="nav-link" aria-label="tobeContinue"><span class="icon iconfont icon-edit"></span>tobeContinue<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="é¡¹ç›®"><span class="title"><span class="icon iconfont icon-edit"></span>é¡¹ç›®</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/zh/posts/%E9%A1%B9%E7%9B%AE%E7%9B%B8%E5%85%B3/%E9%A3%8E%E6%8E%A7%E5%86%B3%E7%AD%96%E5%BC%95%E6%93%8E.html" class="nav-link" aria-label="é£æ§å†³ç­–å¼•æ“ç›¸å…³"><span class="icon iconfont icon-edit"></span>é£æ§å†³ç­–å¼•æ“ç›¸å…³<!----></a></li><li class="dropdown-item"><a href="/zh/posts/%E9%A1%B9%E7%9B%AE%E7%9B%B8%E5%85%B3/FreeBe%E7%9B%B8%E5%85%B3.html" class="nav-link" aria-label="FreeBeç›¸å…³"><span class="icon iconfont icon-edit"></span>FreeBeç›¸å…³<!----></a></li><li class="dropdown-item"><a href="/zh/posts/%E9%A1%B9%E7%9B%AE%E7%9B%B8%E5%85%B3/%E4%B8%AA%E4%BA%BA%E4%B8%BB%E9%A1%B5%E5%8F%8A%E5%8D%9A%E5%AE%A2.html" class="nav-link" aria-label="ä¸ªäººä¸»é¡µåŠåšå®¢"><span class="icon iconfont icon-edit"></span>ä¸ªäººä¸»é¡µåŠåšå®¢<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æŠ€æœ¯"><span class="title"><span class="icon iconfont icon-edit"></span>æŠ€æœ¯</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>é¢˜è§£</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E6%8A%80%E6%9C%AF/LeetCode%E9%A2%98%E8%A7%A3/LeetCode%E9%A2%98%E8%A7%A3.html" class="nav-link" aria-label="LeetCodeé¢˜è§£"><span class="icon iconfont icon-edit"></span>LeetCodeé¢˜è§£<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>ç®—æ³•</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E6%8A%80%E6%9C%AF/%E7%AE%97%E6%B3%95/%E5%9B%BE%E8%AE%BA%E6%95%B4%E7%90%86.html" class="nav-link" aria-label="å›¾è®ºæ•´ç†"><span class="icon iconfont icon-edit"></span>å›¾è®ºæ•´ç†<!----></a></li><li class="dropdown-subitem"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E6%8A%80%E6%9C%AF/%E7%AE%97%E6%B3%95/%E4%BA%8C%E5%88%86%E6%90%9C%E7%B4%A2%E8%BE%B9%E7%95%8C%E5%88%A4%E6%96%AD.html" class="nav-link" aria-label="äºŒåˆ†æœç´¢è¾¹ç•Œåˆ¤æ–­"><span class="icon iconfont icon-edit"></span>äºŒåˆ†æœç´¢è¾¹ç•Œåˆ¤æ–­<!----></a></li><li class="dropdown-subitem"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E6%8A%80%E6%9C%AF/%E7%AE%97%E6%B3%95/%E5%B9%B6%E6%9F%A5%E9%9B%86.html" class="nav-link" aria-label="å¹¶æŸ¥é›†"><span class="icon iconfont icon-edit"></span>å¹¶æŸ¥é›†<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>åç«¯</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E6%8A%80%E6%9C%AF/%E5%90%8E%E7%AB%AF/java%E5%9F%BA%E7%A1%80.html" class="nav-link" aria-label="javaåŸºç¡€"><span class="icon iconfont icon-edit"></span>javaåŸºç¡€<!----></a></li><li class="dropdown-subitem"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E6%8A%80%E6%9C%AF/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93.html" class="nav-link" aria-label="æ•°æ®åº“"><span class="icon iconfont icon-edit"></span>æ•°æ®åº“<!----></a></li><li class="dropdown-subitem"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E6%8A%80%E6%9C%AF/%E5%90%8E%E7%AB%AF/redis.html" class="nav-link" aria-label="redis"><span class="icon iconfont icon-edit"></span>redis<!----></a></li><li class="dropdown-subitem"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E6%8A%80%E6%9C%AF/%E5%90%8E%E7%AB%AF/%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6.html" class="nav-link" aria-label="å¼€å‘æ¡†æ¶"><span class="icon iconfont icon-edit"></span>å¼€å‘æ¡†æ¶<!----></a></li><li class="dropdown-subitem"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E6%8A%80%E6%9C%AF/%E5%90%8E%E7%AB%AF/%E7%9F%A5%E8%AF%86%E9%93%BE%E6%8E%A5.html" class="nav-link" aria-label="çŸ¥è¯†é“¾æ¥"><span class="icon iconfont icon-edit"></span>çŸ¥è¯†é“¾æ¥<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æ–‡ç« ç¿»è¯‘"><span class="title"><span class="icon iconfont icon-edit"></span>æ–‡ç« ç¿»è¯‘</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E6%A8%A1%E5%BC%8F%E8%AE%BE%E8%AE%A1.html" class="nav-link" aria-label="K8sæ¨¡å¼"><span class="icon iconfont icon-edit"></span>K8sæ¨¡å¼<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/about/About.html" class="nav-link" aria-label="å…³äº"><span class="icon iconfont icon-discover"></span>å…³äº<!----></a></div></nav><div class="nav-item"><a class="repo-link" href="https://github.com/Aiyin5/Aiyin5.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!----><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/" class="nav-link sidebar-link sidebar-page" aria-label="ä¸»é¡µ"><span class="icon iconfont icon-home"></span>ä¸»é¡µ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><p class="sidebar-heading active"><span class="icon iconfont icon-note"></span><span class="title">æ–‡ç« </span><!----></p><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">å…³äºæŠ€æœ¯</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">å…³äºè‰¾å› </span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">æ–‡ç« ç¿»è¯‘</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">K8sæ¨¡å¼</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E6%A8%A1%E5%BC%8F%E8%AE%BE%E8%AE%A1.html" class="nav-link sidebar-link sidebar-page" aria-label="K8sæ¨¡å¼ç¿»è¯‘"><span class="icon iconfont icon-page"></span>K8sæ¨¡å¼ç¿»è¯‘<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">K8såŸºç¡€æ¨¡å¼</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F.html" class="nav-link sidebar-link sidebar-page" aria-label="ç¬¬äºŒç«  åŸºç¡€æ¨¡å¼"><span class="icon iconfont icon-page"></span>ç¬¬äºŒç«  åŸºç¡€æ¨¡å¼<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E5%8F%AF%E9%A2%84%E6%B5%8B%E7%9A%84%E9%9C%80%E6%B1%82.html" class="nav-link sidebar-link sidebar-page" aria-label="åŸºç¡€æ¨¡å¼-å¯é¢„æµ‹çš„éœ€æ±‚"><span class="icon iconfont icon-page"></span>åŸºç¡€æ¨¡å¼-å¯é¢„æµ‹çš„éœ€æ±‚<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E5%A3%B0%E6%98%8E%E6%80%A7%E9%83%A8%E7%BD%B2.html" class="nav-link sidebar-link sidebar-page" aria-label="åŸºç¡€æ¨¡å¼ å£°æ˜å¼éƒ¨ç½²"><span class="icon iconfont icon-page"></span>åŸºç¡€æ¨¡å¼ å£°æ˜å¼éƒ¨ç½²<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E5%81%A5%E5%BA%B7%E6%8E%A2%E9%92%88.html" class="nav-link sidebar-link sidebar-page" aria-label="åŸºç¡€æ¨¡å¼ å¥åº·æ¢é’ˆ"><span class="icon iconfont icon-page"></span>åŸºç¡€æ¨¡å¼ å¥åº·æ¢é’ˆ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E6%89%98%E7%AE%A1%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="åŸºç¡€æ¨¡å¼ æ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸ"><span class="icon iconfont icon-page"></span>åŸºç¡€æ¨¡å¼ æ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸ<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E6%89%98%E7%AE%A1%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html#_2-4-managed-lifecycle-æ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.4 Managed Lifecycle Â æ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸ"><!---->2.4 Managed Lifecycle Â æ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸ<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E6%89%98%E7%AE%A1%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html#_2-4-1-problem-é—®é¢˜" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.4.1 Problem Â é—®é¢˜"><!---->2.4.1 Problem Â é—®é¢˜<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E6%89%98%E7%AE%A1%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html#_2-4-2-solution-è§£å†³æ–¹æ¡ˆ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.4.2 Solution Â è§£å†³æ–¹æ¡ˆ"><!---->2.4.2 Solution Â è§£å†³æ–¹æ¡ˆ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E6%89%98%E7%AE%A1%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html#_2-4-3-discussion-è®¨è®º" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.4.3 Discussion Â è®¨è®º"><!---->2.4.3 Discussion Â è®¨è®º<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B8%83%E5%B1%80%EF%BC%88Pod%E7%9A%84%E6%94%BE%E7%BD%AE%EF%BC%89.html" class="nav-link sidebar-link sidebar-page" aria-label="åŸºç¡€æ¨¡å¼ è‡ªåŠ¨åŒ–å¸ƒå±€"><span class="icon iconfont icon-page"></span>åŸºç¡€æ¨¡å¼ è‡ªåŠ¨åŒ–å¸ƒå±€<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">K8sçš„ç®€ä»‹</span><span class="arrow right"></span></button><!----></section></li></ul></section></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">é¡¹ç›®ç›¸å…³</span><span class="arrow right"></span></button><!----></section></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><span class="icon iconfont icon-page"></span>åŸºç¡€æ¨¡å¼ æ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸ</h1><div class="page-info"><span class="author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="http://www.aiyin.xyz" target="_blank" rel="noopener noreferrer">è‰¾å› </a></span><span property="author" content="è‰¾å› "></span></span><!----><span class="date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-01-05T00:00:00.000Z"></span><span class="category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><span class="category-item category4 clickable" role="navigation">æŠ€æœ¯</span><span class="category-item category2 clickable" role="navigation">K8s</span><meta property="articleSection" content="æŠ€æœ¯,K8s"></span><span class="tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><span class="tag-item tag-item1 clickable" role="navigation">ç¿»è¯‘</span><meta property="keywords" content="ç¿»è¯‘"></span><span class="reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 14 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT14M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E6%89%98%E7%AE%A1%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html#_2-4-managed-lifecycle-æ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸ" class="router-link-active router-link-exact-active toc-link level2">2.4 Managed Lifecycle Â æ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E6%89%98%E7%AE%A1%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html#_2-4-1-problem-é—®é¢˜" class="router-link-active router-link-exact-active toc-link level3">2.4.1 Problem Â é—®é¢˜</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E6%89%98%E7%AE%A1%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html#_2-4-2-solution-è§£å†³æ–¹æ¡ˆ" class="router-link-active router-link-exact-active toc-link level3">2.4.2 Solution Â è§£å†³æ–¹æ¡ˆ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E6%89%98%E7%AE%A1%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html#_2-4-3-discussion-è®¨è®º" class="router-link-active router-link-exact-active toc-link level3">2.4.3 Discussion Â è®¨è®º</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="åŸºç¡€æ¨¡å¼-æ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸ" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¨¡å¼-æ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸ" aria-hidden="true">#</a> åŸºç¡€æ¨¡å¼ æ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸ</h1><h2 id="_2-4-managed-lifecycle-æ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸ" tabindex="-1"><a class="header-anchor" href="#_2-4-managed-lifecycle-æ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸ" aria-hidden="true">#</a> 2.4 Managed Lifecycle Â æ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸ</h2><p>Containerized applications managed by cloud-native platforms have no control over their lifecycle, and to be good cloud-native citizens, they have to listen to the events emitted by the managing platform and adapt their lifecycles accordingly. The Managed Lifecycle pattern describes how applications can and should react to these lifecycle events.</p><p>ç”±äº‘åŸç”Ÿå¹³å°(K8s)ç®¡ç†çš„å®¹å™¨åŒ–åº”ç”¨ç¨‹åºæ— æ³•æ§åˆ¶å…¶ç”Ÿå‘½å‘¨æœŸï¼Œè¦æˆä¸ºä¼˜ç§€çš„äº‘åŸç”Ÿå…¬æ°‘ï¼Œä»–ä»¬å¿…é¡»å€¾å¬ç®¡ç†å¹³å°å‘å‡ºçš„äº‹ä»¶ï¼Œå¹¶ç›¸åº”åœ°è°ƒæ•´å…¶ç”Ÿå‘½å‘¨æœŸã€‚æ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸæ¨¡å¼æè¿°äº†åº”ç”¨ç¨‹åºå¦‚ä½•å®ç°å€¾å¬å¹¶å“åº”è¿™äº›ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ã€‚</p><h3 id="_2-4-1-problem-é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_2-4-1-problem-é—®é¢˜" aria-hidden="true">#</a> 2.4.1 Problem Â é—®é¢˜</h3><p>In Chapter 4, Health Probe we explained why containers have to provide APIs for the different health checks. Health-check APIs are read-only endpoints the platform is continually probing to get application insight. It is a mechanism for the platform to extract information from the application.</p><p>åœ¨ä¸Šä¸€èŠ‚ï¼Œå¥åº·æ¢é’ˆä¸­ï¼Œæˆ‘ä»¬è§£é‡Šäº†ä¸ºä»€ä¹ˆå®¹å™¨å¿…é¡»ä¸ºä¸åŒçš„å¥åº·æ£€æŸ¥æä¾›APIã€‚è¿è¡ŒçŠ¶å†µæ£€æŸ¥APIæ˜¯åªè¯»ç«¯ç‚¹ï¼Œå¹³å°æ­£åœ¨ä¸æ–­æ¢æµ‹ä»¥è·å–åº”ç”¨ç¨‹åºæ´å¯ŸåŠ›ã€‚å®ƒæ˜¯å¹³å°ä»åº”ç”¨ç¨‹åºä¸­æå–ä¿¡æ¯çš„æœºåˆ¶ã€‚</p><p>In addition to monitoring the state of a container, the platform sometimes may issue commands and expect the application to react on these. Driven by policies and external factors, a cloud-native platform may decide to start or stop the applications it is managing at any moment. It is up to the containerized application to determine which events are important to react to and how to react. But in effect, this is an API that the platform is using to communicate and send commands to the application. Also, applications are free to either benefit from lifecycle management or ignore it if they donâ€™t need this service.</p><p>é™¤äº†ç›‘æ§å®¹å™¨çš„çŠ¶æ€å¤–ï¼Œå¹³å°æœ‰æ—¶å¯èƒ½ä¼šå‘å‡ºå‘½ä»¤ï¼Œå¹¶æœŸæœ›åº”ç”¨ç¨‹åºå¯¹è¿™äº›å‘½ä»¤åšå‡ºååº”ã€‚åœ¨æ”¿ç­–å’Œå¤–éƒ¨å› ç´ çš„é©±åŠ¨ä¸‹ï¼Œäº‘åŸç”Ÿå¹³å°å¯èƒ½éšæ—¶å†³å®šå¯åŠ¨æˆ–åœæ­¢å…¶æ­£åœ¨ç®¡ç†çš„åº”ç”¨ç¨‹åºã€‚ç”±å®¹å™¨åŒ–åº”ç”¨ç¨‹åºå†³å®šå“ªäº›äº‹ä»¶æ˜¯é‡è¦çš„ï¼Œä»¥åŠå¦‚ä½•ä½œå‡ºååº”ã€‚ä½†å®é™…ä¸Šï¼Œè¿™æ˜¯å¹³å°ç”¨æ¥ä¸åº”ç”¨ç¨‹åºé€šä¿¡å’Œå‘åº”ç”¨ç¨‹åºå‘é€å‘½ä»¤çš„APIã€‚æ­¤å¤–ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥å…è´¹ä»ç”Ÿå‘½å‘¨æœŸç®¡ç†ä¸­è·ç›Šï¼Œä¹Ÿå¯ä»¥åœ¨ä¸éœ€è¦æ­¤æœåŠ¡çš„æƒ…å†µä¸‹å¿½ç•¥ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚</p><h3 id="_2-4-2-solution-è§£å†³æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#_2-4-2-solution-è§£å†³æ–¹æ¡ˆ" aria-hidden="true">#</a> 2.4.2 Solution Â è§£å†³æ–¹æ¡ˆ</h3><p>We saw that checking only the process status is not a good enough indication of the health of an application. That is why there are different APIs for monitoring the health of a container.Similarly, using only the process model to run and stop a process is not good enough. Real-world applications require more fine-grained interactions and lifecycle management capabilities. Some applications need help to warm up, and some applications need a gentle and clean shutdown procedure. For this and other use cases, some events, as shown in Figure 5-1, are emitted by the platform that the container can listen to and react to if desired.</p><p>æˆ‘ä»¬å‘ç°ï¼Œä»…æ£€æŸ¥è¿›ç¨‹çŠ¶æ€å¹¶ä¸èƒ½å¾ˆå¥½åœ°æŒ‡ç¤ºåº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶å†µã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæœ‰ä¸åŒçš„APIæ¥ç›‘æ§å®¹å™¨çš„è¿è¡ŒçŠ¶å†µã€‚ç±»ä¼¼åœ°ï¼Œä»…ä½¿ç”¨è¿›ç¨‹æ¨¡å‹æ¥è¿è¡Œå’Œåœæ­¢è¿›ç¨‹æ˜¯ä¸å¤Ÿçš„ã€‚ç°å®ä¸–ç•Œçš„åº”ç”¨ç¨‹åºéœ€è¦æ›´ç»†ç²’åº¦çš„äº¤äº’å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†åŠŸèƒ½ã€‚æœ‰äº›åº”ç”¨ç¨‹åºéœ€è¦å¸®åŠ©é¢„çƒ­ï¼Œæœ‰äº›åº”ç”¨ç¨‹åºéœ€è¦æ¸©å’Œæ¸…æ´çš„å…³æœºç¨‹åºã€‚å¯¹äºæ­¤ç”¨ä¾‹å’Œå…¶ä»–ç”¨ä¾‹ï¼Œä¸€äº›äº‹ä»¶ï¼ˆå¦‚å›¾5-1æ‰€ç¤ºï¼‰ç”±å¹³å°å‘å‡ºï¼Œå®¹å™¨å¯ä»¥æ ¹æ®éœ€è¦ç›‘å¬å’Œå“åº”è¿™äº›äº‹ä»¶ã€‚</p><figure><img src="https://cdn.nlark.com/yuque/0/2021/png/2466332/1636031064873-0e6dfaeb-933c-44e0-9fbb-6f86ac1025e1.png#clientId=u7e39b311-edf8-4&amp;from=paste&amp;height=280&amp;id=u5d437030&amp;margin=[object Object]&amp;name=image.png&amp;originHeight=280&amp;originWidth=781&amp;originalType=binary&amp;ratio=1&amp;size=31977&amp;status=done&amp;style=none&amp;taskId=u2f5b3034-9843-4719-a45c-5b608625a85&amp;width=781" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>Figure 5-1. Managed container lifecycle</p><p>The deployment unit of an application is a Pod. As you already know, a Pod is composed of one or more containers. At the Pod level, there are other constructs such as init containers, which we cover in Chapter 14, Init Â Container (and defer-containers, which is still at the proposal stage as of this writing) that can help manage the container lifecycle. The events and hooks we describe in this chapter are all applied at an individual container level rather than Pod level.</p><p>åº”ç”¨ç¨‹åºçš„éƒ¨ç½²å•å…ƒæ˜¯Podã€‚æ­£å¦‚ä½ å·²ç»çŸ¥é“çš„ï¼Œä¸€ä¸ªPodç”±ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ç»„æˆã€‚åœ¨Podçº§åˆ«ï¼Œè¿˜æœ‰å…¶ä»–çš„æ„é€ ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨åé¢ç« èŠ‚ä¸­ä»‹ç»çš„åˆå§‹åŒ–å®¹å™¨ï¼ˆä»¥åŠå»¶è¿Ÿå®¹å™¨ï¼Œåœ¨æ’°å†™æœ¬æ–‡æ—¶ä»å¤„äºå»ºè®®é˜¶æ®µï¼‰å¯ä»¥å¸®åŠ©ç®¡ç†å®¹å™¨ç”Ÿå‘½å‘¨æœŸã€‚æˆ‘ä»¬åœ¨æœ¬ç« ä¸­æè¿°çš„äº‹ä»¶å’Œé’©å­éƒ½åº”ç”¨äºå•ä¸ªå®¹å™¨çº§åˆ«ï¼Œè€Œä¸æ˜¯Podçº§åˆ«ã€‚</p><h4 id="_2-4-2-1-sigterm-signal-sigterm-ä¿¡å·" tabindex="-1"><a class="header-anchor" href="#_2-4-2-1-sigterm-signal-sigterm-ä¿¡å·" aria-hidden="true">#</a> 2.4.2.1 SIGTERM Signal Â  SIGTERM ä¿¡å·</h4><p>Whenever Kubernetes decides to shut down a container, whether that is because the Pod it belongs to is shutting down or simply a failed liveness probe causes the container to be restarted, the container receives a SIGTERM signal. SIGTERM is a gentle poke for the container to shut down cleanly before Kubernetes sends a more abrupt SIGKILL signal. Once a SIGTERM signal has been received, the application should shut down as quickly as possible. For some applications, this might be a quick termination, and some other applications may have to complete their in-flight requests, release open connections, and clean up temp files, which can take a slightly longer time. In all cases, reacting to SIGTERM is the right moment to shut down a container in a clean way.</p><p>æ¯å½“Kuberneteså†³å®šå…³é—­ä¸€ä¸ªå®¹å™¨æ—¶ï¼Œæ— è®ºæ˜¯å› ä¸ºå®ƒæ‰€å±çš„Podæ­£åœ¨å…³é—­ï¼Œè¿˜æ˜¯ä»…ä»…æ˜¯ç”±äºlivenessæ¢æµ‹å™¨æ•…éšœå¯¼è‡´å®¹å™¨é‡æ–°å¯åŠ¨ï¼Œå®¹å™¨éƒ½ä¼šæ”¶åˆ°ä¸€ä¸ªSIGTERMä¿¡å·ã€‚SIGTERMæ˜¯ä¸€ä¸ªæ¸©å’Œçš„ä¿¡å·ï¼Œåœ¨Kuberneteså‘å‡ºæ›´çªç„¶çš„SIGKILLä¿¡å·ä¹‹å‰ï¼Œå®¹å™¨å¯ä»¥å¹²å‡€åœ°å…³é—­ã€‚ä¸€æ—¦æ”¶åˆ°SIGTERMä¿¡å·ï¼Œåº”ç”¨ç¨‹åºåº”å°½å¿«å…³é—­ã€‚å¯¹äºæŸäº›åº”ç”¨ç¨‹åºï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªå¿«é€Ÿç»ˆæ­¢ï¼Œè€Œå…¶ä»–ä¸€äº›åº”ç”¨ç¨‹åºå¯èƒ½éœ€è¦å®Œæˆå…¶è¿›è¡Œä¸­çš„è¯·æ±‚ã€é‡Šæ”¾æ‰“å¼€çš„è¿æ¥å¹¶æ¸…ç†ä¸´æ—¶æ–‡ä»¶ï¼Œè¿™å¯èƒ½éœ€è¦ç¨é•¿çš„æ—¶é—´ã€‚åœ¨æ‰€æœ‰æƒ…å†µä¸‹ï¼Œå¯¹SIGTERMä½œå‡ºååº”æ˜¯ä»¥å¹²å‡€ï¼ˆä¼˜é›…ï¼‰çš„æ–¹å¼å…³é—­å®¹å™¨çš„æ­£ç¡®æ—¶æœºã€‚</p><h4 id="_2-4-2-2-sigkill-signal-sigkill-ä¿¡å·" tabindex="-1"><a class="header-anchor" href="#_2-4-2-2-sigkill-signal-sigkill-ä¿¡å·" aria-hidden="true">#</a> 2.4.2.2 SIGKILL Signal Â  SIGKILL Â ä¿¡å·</h4><p>If a container process has not shut down after a SIGTERM signal, it is shut down forcefully by the following SIGKILL signal. Kubernetes does not send the SIGKILL signal immediately but waits for a grace period of 30 seconds by default after it has issued a SIGTERM signal. This grace period can be defined per Pod using the <code>.spec.terminationGracePeriodSeconds</code> field, but cannot be guaranteed as it can be overridden while issuing commands to Kubernetes. The aim here should be to design and implement containerized applications to be ephemeral with quick startup and shutdown processes.</p><p>å¦‚æœå®¹å™¨è¿›ç¨‹åœ¨æ”¶åˆ°SIGTERMä¿¡å·åæœªå…³é—­ï¼Œå°±è¡Œäº†åˆ™ä¼šæ”¶åˆ°SIGKILLä¿¡å·å¼ºåˆ¶å…³é—­ã€‚Kubernetesä¸ä¼šç«‹å³å‘é€SIGKILLä¿¡å·ï¼Œä½†åœ¨å‘å‡ºSIGTERMä¿¡å·åï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šç­‰å¾…30ç§’çš„å®½é™æœŸã€‚å¯ä»¥ä½¿ç”¨.spec.terminationGracePeriodSecondså­—æ®µä¸ºæ¯ä¸ªPodå®šä¹‰æ­¤å®½é™æœŸï¼Œä½†ä¸èƒ½ä¿è¯åœ¨Kuberneteså‘å‡ºå‘½ä»¤æ—¶ä»ç„¶å¯ä»¥è¦†ç›–æ­¤å®½é™æœŸã€‚è¿™é‡Œçš„ç›®æ ‡åº”è¯¥æ˜¯è®¾è®¡å’Œå®ç°å…·æœ‰å¿«é€Ÿå¯åŠ¨å’Œå…³é—­è¿‡ç¨‹çš„å®¹å™¨åŒ–åº”ç”¨ç¨‹åºã€‚</p><h4 id="_2-4-2-3-poststart-hook-poststart-é’©å­" tabindex="-1"><a class="header-anchor" href="#_2-4-2-3-poststart-hook-poststart-é’©å­" aria-hidden="true">#</a> 2.4.2.3 Poststart Hook Â Poststart é’©å­</h4><p>Using only process signals for managing lifecycles is somewhat limited. That is why there are additional lifecycle hooks such as postStart and preStop provided by Kubernetes. A Pod manifest containing a postStart hook looks like the one in Example 5-1.</p><p>ä»…ä½¿ç”¨è¿›ç¨‹ä¿¡å·æ¥ç®¡ç†ç”Ÿå‘½å‘¨æœŸåœ¨æŸç§ç¨‹åº¦ä¸Šèƒ½åŠ›æ˜¯æœ‰é™çš„ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆKubernetesæä¾›äº†é¢å¤–çš„ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œæ¯”å¦‚<code>postStart</code>å’Œ<code>preStop</code>ã€‚åŒ…å«<code>postStart</code>é’©å­çš„<code>Pod</code>æ¸…å•ä¸ç¤ºä¾‹5-1ä¸­çš„æ¸…å•ç±»ä¼¼ã€‚</p><p>Example 5-1. A container with poststart hook</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> post<span class="token punctuation">-</span>start<span class="token punctuation">-</span>hook
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> k8spatterns/random<span class="token punctuation">-</span>generator<span class="token punctuation">:</span><span class="token number">1.0</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> random<span class="token punctuation">-</span>generator
    <span class="token key atrule">lifecycle</span><span class="token punctuation">:</span>
      <span class="token key atrule">postStart</span><span class="token punctuation">:</span>
        <span class="token key atrule">exec</span><span class="token punctuation">:</span>
          <span class="token key atrule">command</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> sh
          <span class="token punctuation">-</span> <span class="token punctuation">-</span>c
          <span class="token punctuation">-</span> sleep 30 <span class="token important">&amp;&amp;</span> echo &quot;Wake up<span class="token tag">!</span>&quot; <span class="token punctuation">&gt;</span> /tmp/postStart_done
<span class="token comment">#The postStart command waits here 30 seconds. sleep is just a simulation for any lengthy startup code that might run here. Also, it uses a trigger file here to sync with the main application, which starts in parallel.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The <code>postStart</code> command is executed after a container is created, asynchronously with the primary containerâ€™s process. Even if many of the application initialization and warm-up logic can be implemented as part of the container startup steps, <code>postStart</code> still covers some use cases. The <code>postStart</code> action is a blocking call, and the container status remains Waiting until the <code>postStart</code> handler completes, which in turn keeps the Pod status in the Pending state. This nature of <code>postStart</code> can be used to delay the startup state of the container while giving time to the main container process to initialize.</p><p>postStartå‘½ä»¤åœ¨åˆ›å»ºå®¹å™¨åä¸ä¸»å®¹å™¨çš„è¿›ç¨‹å¼‚æ­¥æ‰§è¡Œã€‚å³ä½¿è®¸å¤šåº”ç”¨ç¨‹åºåˆå§‹åŒ–å’Œé¢„çƒ­é€»è¾‘å¯ä»¥ä½œä¸ºå®¹å™¨å¯åŠ¨æ­¥éª¤çš„ä¸€éƒ¨åˆ†å®ç°ï¼ŒpostStartä»ç„¶æ¶µç›–ä¸€äº›ç”¨ä¾‹ã€‚postStartæ“ä½œæ˜¯ä¸€ä¸ªé˜»å¡è°ƒç”¨ï¼Œå®¹å™¨çŠ¶æ€ä¿æŒç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°postStartå¤„ç†ç¨‹åºå®Œæˆï¼Œä»è€Œä½¿PodçŠ¶æ€ä¿æŒåœ¨æŒ‚èµ·çŠ¶æ€ã€‚postStartçš„è¿™ç§æ€§è´¨å¯ä»¥ç”¨æ¥å»¶è¿Ÿå®¹å™¨çš„å¯åŠ¨çŠ¶æ€ï¼ŒåŒæ—¶ç»™ä¸»å®¹å™¨è¿›ç¨‹åˆå§‹åŒ–æ—¶é—´ã€‚</p><p>Another use of <code>postStart</code> is to prevent a container from starting when the Pod does not fulfill certain preconditions. For example, when the <code>postStart</code> hook indicates an error by returning a nonzero exit code, the main container process gets killed by Kubernetes.</p><p>postStartçš„å¦ä¸€ä¸ªç”¨é€”æ˜¯é˜²æ­¢å®¹å™¨åœ¨Podæœªæ»¡è¶³æŸäº›å…ˆå†³æ¡ä»¶æ—¶å¯åŠ¨ã€‚ä¾‹å¦‚ï¼Œå½“postStarté’©å­é€šè¿‡è¿”å›éé›¶çš„é€€å‡ºä»£ç æ¥æŒ‡ç¤ºé”™è¯¯æ—¶ï¼Œä¸»å®¹å™¨è¿›ç¨‹å°†è¢«Kubernetesç»ˆæ­¢ã€‚</p><p><code>postStart</code> and <code>preStop</code> hook invocation mechanisms are similar to the Health Probes described in Chapter 4 and support these handler types:</p><p>postStartå’ŒpreStopé’©å­è°ƒç”¨æœºåˆ¶ç±»ä¼¼äºä¸Šä¸€ç« ä¸­æè¿°çš„è¿è¡ŒçŠ¶å†µæ¢æµ‹ï¼Œå¹¶æ”¯æŒä»¥ä¸‹å¤„ç†ç¨‹åºç±»å‹ï¼š</p><p><code>exec</code> Runs a command directly in the container Â  åœ¨å®¹å™¨ä¸­ç›´æ¥è¿è¡Œä¸€æ¡å‘½ä»¤</p><p><code>httpGet</code> Executes an HTTP GET request against a port opened by one Pod container Â å¯¹ä¸€ä¸ªPodå®¹å™¨æ‰“å¼€çš„ç«¯å£æ‰§è¡ŒHTTP GETè¯·æ±‚</p><p>You have to be very careful what critical logic you execute in the <code>postStart</code> hook as there are no guarantees for its execution. Since the hook is running in parallel with the container process, it is possible that the hook may be executed before the container has started. Also, the hook is intended to have at-least once semantics, so the implementation has to take care of duplicate executions. Another aspect to keep in mind is that the platform does not perform any retry attempts on failed HTTP requests that didnâ€™t reach the handler.</p><p>ä½ å¿…é¡»éå¸¸å°å¿ƒåœ¨<code>postStart</code>é’©å­ä¸­æ‰§è¡Œçš„æ˜¯ä»€ä¹ˆå…³é”®é€»è¾‘ï¼Œå› ä¸ºå®ƒçš„æ‰§è¡Œæ²¡æœ‰ä»»ä½•ä¿è¯ã€‚ç”±äºé’©å­ä¸å®¹å™¨è¿›ç¨‹å¹¶è¡Œè¿è¡Œï¼Œæ‰€ä»¥é’©å­å¯èƒ½åœ¨å®¹å™¨å¯åŠ¨ä¹‹å‰æ‰§è¡Œã€‚æ­¤å¤–ï¼Œé’©å­è‡³å°‘è¦æœ‰ä¸€æ¬¡è¯­ä¹‰ï¼Œå› æ­¤å®ç°å¿…é¡»å¤„ç†é‡å¤æ‰§è¡Œã€‚è¦è®°ä½çš„å¦ä¸€ä¸ªæ–¹é¢æ˜¯ï¼Œå¹³å°ä¸ä¼šå¯¹æœªåˆ°è¾¾å¤„ç†ç¨‹åºçš„å¤±è´¥HTTPè¯·æ±‚æ‰§è¡Œä»»ä½•é‡è¯•å°è¯•ã€‚</p><h4 id="_2-4-2-4-prestop-hook-prestop-é’©å­" tabindex="-1"><a class="header-anchor" href="#_2-4-2-4-prestop-hook-prestop-é’©å­" aria-hidden="true">#</a> 2.4.2.4 Prestop Hook Â Prestop é’©å­</h4><p>The <code>preStop</code> hook is a blocking call sent to a container before it is terminated. It has the same semantics as the SIGTERM signal and should be used to initiate a graceful shutdown of the container when reacting to SIGTERM is not possible. The <code>preStop</code> action in Example 5-2 must complete before the call to delete the container is sent to the container runtime, which triggers the SIGTERM notification.</p><p>preStopé’©å­æ˜¯åœ¨å®¹å™¨ç»ˆæ­¢ä¹‹å‰å‘é€ç»™å®¹å™¨çš„é˜»å¡è°ƒç”¨ã€‚å®ƒä¸SIGTERMä¿¡å·å…·æœ‰ç›¸åŒçš„è¯­ä¹‰ï¼Œå½“æ— æ³•å¯¹SIGTERMä½œå‡ºååº”æ—¶ï¼Œåº”ä½¿ç”¨å®ƒæ¥å¯åŠ¨å®¹å™¨çš„æ­£å¸¸å…³é—­ã€‚åœ¨å°†åˆ é™¤å®¹å™¨çš„è°ƒç”¨å‘é€åˆ°å®¹å™¨è¿è¡Œæ—¶ï¼ˆè§¦å‘SIGTERMé€šçŸ¥ï¼‰ä¹‹å‰ï¼Œéœ€è¦å®Œæˆç¤ºä¾‹5-2ä¸­çš„é¢„åœæ­¢æ“ä½œã€‚</p><p>Example 5-2. A container with a preStop hook</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pre<span class="token punctuation">-</span>stop<span class="token punctuation">-</span>hook
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> k8spatterns/random<span class="token punctuation">-</span>generator<span class="token punctuation">:</span><span class="token number">1.0</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> random<span class="token punctuation">-</span>generator
    <span class="token key atrule">lifecycle</span><span class="token punctuation">:</span>
      <span class="token key atrule">preStop</span><span class="token punctuation">:</span>
        <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
          <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> /shutdown
<span class="token comment">#Call out to a /shutdown endpoint running within the application</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Even though <code>preStop</code> is blocking, holding on it or returning a nonsuccessful result does not prevent the container from being deleted and the process killed. <code>preStop</code> is only a convenient alternative to a SIGTERM signal for graceful application shutdown and nothing more. It also offers the same handler types and guarantees as the postStart hook we covered previously.</p><p>å³ä½¿<code>preStop</code>æ­£åœ¨é˜»å¡ï¼Œä¿æŒå®ƒæˆ–è¿”å›ä¸€ä¸ªä¸æˆåŠŸçš„ç»“æœä¹Ÿä¸èƒ½é˜»æ­¢å®¹å™¨è¢«åˆ é™¤å’Œè¿›ç¨‹è¢«ç»ˆæ­¢ã€‚<code>preStop</code>åªæ˜¯SIGTERMä¿¡å·çš„ä¸€ç§æ–¹ä¾¿çš„æ›¿ä»£æ–¹æ¡ˆï¼Œç”¨äºä¼˜é›…çš„åº”ç”¨ç¨‹åºå…³é—­ï¼Œä»…æ­¤è€Œå·²ã€‚å®ƒè¿˜æä¾›äº†ä¸æˆ‘ä»¬å‰é¢ä»‹ç»çš„<code>postStart</code>é’©å­ç›¸åŒçš„å¤„ç†ç¨‹åºç±»å‹å’Œä¿è¯ã€‚</p><h4 id="_2-4-2-5-other-lifecycle-controls-å…¶ä»–ç”Ÿå‘½å‘¨æœŸæ§åˆ¶æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#_2-4-2-5-other-lifecycle-controls-å…¶ä»–ç”Ÿå‘½å‘¨æœŸæ§åˆ¶æ–¹æ³•" aria-hidden="true">#</a> 2.4.2.5 Other Lifecycle Controls Â å…¶ä»–ç”Ÿå‘½å‘¨æœŸæ§åˆ¶æ–¹æ³•</h4><p>In this chapter, so far we have focused on the hooks that allow executing commands when a container lifecycle event occurs. But another mechanism that is not at the container level but at a Pod level allows executing initialization instructions.</p><p>åœ¨æœ¬ç« ä¸­ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸»è¦å…³æ³¨åœ¨å®¹å™¨ç”Ÿå‘½å‘¨æœŸäº‹ä»¶å‘ç”Ÿæ—¶å…è®¸æ‰§è¡Œå‘½ä»¤çš„é’©å­ã€‚ä½†å¦ä¸€ç§ä¸æ˜¯å®¹å™¨çº§è€Œæ˜¯Podçº§çš„æœºåˆ¶å…è®¸æ‰§è¡Œåˆå§‹åŒ–æŒ‡ä»¤ã€‚</p><p>We describe in Chapter 14, Init Container, in depth, but here we describe it briefly to compare it with lifecycle hooks. Unlike regular application containers, init containers run sequentially, run until completion, and run before any of the application containers in a Pod start up. These guarantees allow using init containers for Pod-level initialization tasks. Both lifecycle hooks and init containers operate at a different granularity (at container level and Pod-level, respectively) and could be used interchangeably in some instances, or complement each other in other cases. Table 5-1 summarizes the main differences between the two.</p><p>æˆ‘ä»¬åœ¨åé¢çš„Init Containerç« èŠ‚ä¸­è¿›è¡Œäº†Podçº§çš„æœºåˆ¶æ·±å…¥çš„æè¿°ï¼Œä½†è¿™é‡Œæˆ‘ä»¬ç®€è¦åœ°æè¿°äº†å®ƒï¼Œä»¥å°†å…¶ä¸ç”Ÿå‘½å‘¨æœŸæŒ‚é’©è¿›è¡Œæ¯”è¾ƒã€‚ä¸å¸¸è§„åº”ç”¨ç¨‹åºå®¹å™¨ä¸åŒï¼Œinitå®¹å™¨æŒ‰é¡ºåºè¿è¡Œï¼Œè¿è¡Œåˆ°å®Œæˆï¼Œå¹¶åœ¨Podä¸­çš„ä»»ä½•åº”ç”¨ç¨‹åºå®¹å™¨å¯åŠ¨ä¹‹å‰è¿è¡Œã€‚è¿™äº›ä¿è¯å…è®¸å¯¹Podçº§åˆå§‹åŒ–ä»»åŠ¡ä½¿ç”¨initå®¹å™¨ã€‚lifecycleé’©å­å’Œinitå®¹å™¨éƒ½ä»¥ä¸åŒçš„ç²’åº¦ï¼ˆåˆ†åˆ«åœ¨å®¹å™¨çº§åˆ«å’ŒPodçº§åˆ«ï¼‰è¿è¡Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥äº’æ¢ä½¿ç”¨ï¼Œæˆ–è€…åœ¨å…¶ä»–æƒ…å†µä¸‹å¯ä»¥ç›¸äº’è¡¥å……ã€‚è¡¨5-1æ€»ç»“äº†ä¸¤è€…ä¹‹é—´çš„ä¸»è¦å·®å¼‚ã€‚</p><p>Table 5-1. Lifecycle Hooks and Init Containers</p><table><thead><tr><th>Aspect</th><th>Lifecycle hooks</th><th>Init Containers</th></tr></thead><tbody><tr><td>Activates on</td><td>Container lifecycle phases</td><td>Pod lifecycle phases</td></tr><tr><td>Startup phase action</td><td>A <code>postStart</code></td><td></td></tr><tr><td>command</td><td>A list of <code>initContainers</code></td><td></td></tr><tr><td>to execute</td><td></td><td></td></tr><tr><td>Shutdown phase action</td><td>A <code>preStop</code></td><td></td></tr><tr><td>command</td><td>No equivalent feature exists yet</td><td></td></tr><tr><td>Timing guarantees</td><td>A <code>postStart</code></td><td></td></tr><tr><td>command is executed at the same time as the containerâ€™s <code>ENTRYPOINT</code></td><td>All init containers must be completed successfully before any application container can start</td><td></td></tr><tr><td>Use cases</td><td>Perform noncritical startup/shutdown cleanups specific to a container</td><td>Perform workflow-like sequential operations using containers; reuse containers for task executions</td></tr></tbody></table><p>There are no strict rules about which mechanism to use except when you require a specific timing guarantee. We could skip lifecycle hooks and init containers entirely and use a bash script to perform specific actions as part of a containerâ€™s startup or shutdown commands. That is possible, but it would tightly couple the container with the script and turn it into a maintenance nightmare.</p><p>å¯¹äºä½¿ç”¨å“ªç§æœºåˆ¶æ²¡æœ‰ä¸¥æ ¼çš„è§„å®šï¼Œé™¤ééœ€è¦ç‰¹å®šçš„æ—¶é—´ä¿è¯ã€‚æˆ‘ä»¬å¯ä»¥å®Œå…¨è·³è¿‡ç”Ÿå‘½å‘¨æœŸæŒ‚é’©å’Œinitå®¹å™¨ï¼Œå¹¶ä½¿ç”¨bashè„šæœ¬ä½œä¸ºå®¹å™¨å¯åŠ¨æˆ–å…³é—­å‘½ä»¤çš„ä¸€éƒ¨åˆ†æ¥æ‰§è¡Œç‰¹å®šæ“ä½œã€‚è¿™æ˜¯å¯èƒ½çš„ï¼Œä½†å®ƒä¼šå°†å®¹å™¨ä¸è„šæœ¬ç´§å¯†è€¦åˆï¼Œå¹¶å°†å…¶å˜æˆç»´æŠ¤å™©æ¢¦ã€‚</p><p>We could also use Kubernetes lifecycle hooks to perform some actions as described in this chapter. Alternatively, we could go even further and run containers that perform individual actions using init containers. In this sequence, the options require more effort increasingly, but at the same time offer stronger guarantees and enable reuse.</p><p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨Kubernetesç”Ÿå‘½å‘¨æœŸæŒ‚é’©æ¥æ‰§è¡Œæœ¬ç« ä¸­æè¿°çš„ä¸€äº›æ“ä½œã€‚æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥æ›´è¿›ä¸€æ­¥ï¼Œä½¿ç”¨initå®¹å™¨è¿è¡Œæ‰§è¡Œå•ä¸ªæ“ä½œçš„å®¹å™¨ã€‚åœ¨è¿™ä¸ªåºåˆ—ä¸­ï¼Œé€‰é¡¹éœ€è¦è¶Šæ¥è¶Šå¤šçš„åŠªåŠ›ï¼Œä½†åŒæ—¶æä¾›äº†æ›´æœ‰åŠ›çš„ä¿è¯å¹¶æ”¯æŒé‡ç”¨ã€‚</p><p>Understanding the stages and available hooks of containers and Pod lifecycles is crucial for creating applications that benefit from being managed by Kubernetes.</p><p>äº†è§£å®¹å™¨å’ŒPodç”Ÿå‘½å‘¨æœŸçš„é˜¶æ®µå’Œå¯ç”¨é’©å­ï¼Œå¯¹äºåˆ›å»ºå—ç›ŠäºKubernetesç®¡ç†çš„åº”ç”¨ç¨‹åºè‡³å…³é‡è¦ã€‚</p><h3 id="_2-4-3-discussion-è®¨è®º" tabindex="-1"><a class="header-anchor" href="#_2-4-3-discussion-è®¨è®º" aria-hidden="true">#</a> 2.4.3 Discussion Â è®¨è®º</h3><p>One of the main benefits the cloud-native platform provides is the ability to run and scale applications reliably and predictably on top of potentially unreliable cloud infrastructure. These platforms provide a set of constraints and contracts for an application running on them. It is in the interest of the application to honor these contracts to benefit from all of the capabilities offered by the cloud-native platform.</p><p>äº‘åŸç”Ÿå¹³å°çš„ä¸»è¦å¥½å¤„ä¹‹ä¸€æ˜¯æä¾›äº†èƒ½å¤Ÿåœ¨ä¸å¯é çš„äº‘åŸºç¡€è®¾æ–½ä¹‹ä¸Šæ„å»ºå¯é ã€å¯é¢„æµ‹åœ°è¿è¡Œå’Œæ‰©å±•åº”ç”¨ç¨‹åºçš„èƒ½åŠ›ã€‚äº‘åŸç”Ÿå¹³å°ä¸ºè¿™äº›è¿è¡Œåœ¨å¹³å°ä¸Šçš„åº”ç”¨ç¨‹åºæä¾›äº†ä¸€ç»„çº¦æŸå’Œå¥‘çº¦ã€‚ä¸ºäº†è·å–äº‘åŸç”Ÿå¹³å°æä¾›çš„è¿™äº›ä¼˜åŠ¿å’Œèƒ½åŠ›ï¼Œåº”ç”¨ç¨‹åºéœ€è¦éµå®ˆè¿™äº›å¥‘çº¦å’Œçº¦æŸã€‚</p><p>Handling and reacting to these events ensures your application can gracefully start up and shut down with minimal impact on the consuming services. At the moment, in its basic form, that means the containers should behave as any well-designed POSIX process. In the future, there might be even more events giving hints to the application when it is about to be scaled up, or asked to release resources to prevent being shut down. It is essential to get into the mindset where the application lifecycle is no longer in the control of a person but fully automated by the platform.</p><p>å¤„ç†å’Œå“åº”è¿™äº›äº‹ä»¶ï¼ˆé€šçŸ¥ä¿¡å·å’Œé’©å­ï¼‰å¯ç¡®ä¿åº”ç”¨ç¨‹åºèƒ½å¤Ÿæ­£å¸¸å¯åŠ¨å’Œå…³é—­ï¼Œè€Œå¯¹ä½¿ç”¨æœåŠ¡çš„å½±å“æœ€å°ã€‚ç›®å‰ï¼Œåœ¨å…¶åŸºæœ¬å½¢å¼ä¸­ï¼Œè¿™æ„å‘³ç€å®¹å™¨åº”è¯¥åƒä»»ä½•è®¾è®¡è‰¯å¥½çš„POSIXè¿›ç¨‹ä¸€æ ·å·¥ä½œã€‚å°†æ¥ï¼Œå¯èƒ½ä¼šæœ‰æ›´å¤šçš„äº‹ä»¶åœ¨åº”ç”¨ç¨‹åºå³å°†æ‰©å±•æ—¶å‘åº”ç”¨ç¨‹åºæä¾›æç¤ºï¼Œæˆ–è€…è¯·æ±‚é‡Šæ”¾èµ„æºä»¥é˜²æ­¢è¢«å…³é—­ã€‚å¿…é¡»è¿›å…¥è¿™æ ·çš„æ€ç»´æ¨¡å¼ï¼šåº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸä¸å†ç”±ä¸ªäººæ§åˆ¶ï¼Œè€Œæ˜¯ç”±å¹³å°å®Œå…¨è‡ªåŠ¨åŒ–ã€‚</p><p>Besides managing the application lifecycle, the other big duty of orchestration platforms like Kubernetes is to distribute containers over a fleet of nodes. The next pattern, Automated Placement, explains the options to influence the scheduling decisions from the outside.</p><p>é™¤äº†ç®¡ç†åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸå¤–ï¼ŒKubernetesç­‰ç¼–æ’å¹³å°çš„å¦ä¸€é¡¹é‡è¦èŒè´£æ˜¯åœ¨ä¸€ç»„èŠ‚ç‚¹ä¸Šåˆ†å‘å®¹å™¨ã€‚ä¸‹ä¸€èŠ‚ä¸­çš„æ¨¡å¼æ˜¯è‡ªåŠ¨å¸ƒå±€ï¼Œå®ƒé˜è¿°äº†ä»å¤–éƒ¨å½±å“è°ƒåº¦å†³ç­–çš„é€‰é¡¹ã€‚</p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/Aiyin5/Aiyin5.github.io/edit/main/docs/zh/posts/æ–‡ç« ç¿»è¯‘/K8sæ¨¡å¼/K8såŸºç¡€æ¨¡å¼/æ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸ.md" rel="noopener noreferrer" target="_blank" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="meta-item contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: 372020407@qq.com">aiyin</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E5%81%A5%E5%BA%B7%E6%8E%A2%E9%92%88.html" class="nav-link prev" aria-label="åŸºç¡€æ¨¡å¼ å¥åº·æ¢é’ˆ"><div class="hint"><span class="arrow left"></span>ä¸Šä¸€é¡µ</div><div class="link"><span class="icon iconfont icon-page"></span>åŸºç¡€æ¨¡å¼ å¥åº·æ¢é’ˆ</div></a><a href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B8%83%E5%B1%80%EF%BC%88Pod%E7%9A%84%E6%94%BE%E7%BD%AE%EF%BC%89.html" class="nav-link next" aria-label="åŸºç¡€æ¨¡å¼ è‡ªåŠ¨åŒ–å¸ƒå±€"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow right"></span></div><div class="link">åŸºç¡€æ¨¡å¼ è‡ªåŠ¨åŒ–å¸ƒå±€<span class="icon iconfont icon-page"></span></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer"><a href="/about/About">å…³äºç½‘ç«™</a></div><div class="copyright">Copyright Â© 2023 è‰¾å› </div></footer><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-29be8814.js" defer></script>
  </body>
</html>
