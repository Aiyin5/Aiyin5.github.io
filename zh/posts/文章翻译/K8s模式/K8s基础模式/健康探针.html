<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.58" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://aiyin5.github.io/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E5%81%A5%E5%BA%B7%E6%8E%A2%E9%92%88.html"><meta property="og:site_name" content="è‰¾å› çš„åšå®¢"><meta property="og:title" content="åŸºç¡€æ¨¡å¼ å¥åº·æ¢é’ˆ"><meta property="og:description" content="åŸºç¡€æ¨¡å¼ å¥åº·æ¢é’ˆ 2.3 Health Probe 2.3 å¥åº·æ¢é’ˆ The Health Probe pattern is about how an application can communicate its health state to Kubernetes. To be fully automatable, a cloud-native application must be highly observable by allowing its state to be inferred so that Kubernetes can detect whether the application is up and whether it is ready to serve requests. These observations influence the lifecycle management of Pods and the way traffic is routed to the application."><meta property="og:type" content="article"><meta property="og:updated_time" content="2023-01-12T05:00:13.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:tag" content="ç¿»è¯‘"><meta property="article:published_time" content="2023-01-05T00:00:00.000Z"><meta property="article:modified_time" content="2023-01-12T05:00:13.000Z"><title>åŸºç¡€æ¨¡å¼ å¥åº·æ¢é’ˆ | è‰¾å› çš„åšå®¢</title><meta name="description" content="åŸºç¡€æ¨¡å¼ å¥åº·æ¢é’ˆ 2.3 Health Probe 2.3 å¥åº·æ¢é’ˆ The Health Probe pattern is about how an application can communicate its health state to Kubernetes. To be fully automatable, a cloud-native application must be highly observable by allowing its state to be inferred so that Kubernetes can detect whether the application is up and whether it is ready to serve requests. These observations influence the lifecycle management of Pods and the way traffic is routed to the application.">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-4e49b06b.css" as="style"><link rel="stylesheet" href="/assets/style-4e49b06b.css">
    <link rel="modulepreload" href="/assets/app-28e805c5.js"><link rel="modulepreload" href="/assets/framework-e28fa486.js"><link rel="modulepreload" href="/assets/å¥åº·æ¢é’ˆ.html-a53b71b3.js"><link rel="modulepreload" href="/assets/å¥åº·æ¢é’ˆ.html-1bd8f94f.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/rabbitMan.jpg" alt="è‰¾å› çš„åšå®¢"><!----><span class="site-name hide-in-pad">è‰¾å› çš„åšå®¢</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><!----><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="ä¸»é¡µ"><span class="icon iconfont icon-home"></span>ä¸»é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="è‰¾å› çš„ä¸–ç•Œ"><span class="title"><span class="icon iconfont icon-discover"></span>è‰¾å› çš„ä¸–ç•Œ</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E8%89%BE%E5%9B%A0/%E5%85%B3%E4%BA%8E%E8%89%BE%E5%9B%A0.html" class="nav-link" aria-label="å…³äºè‰¾å› "><span class="icon iconfont icon-edit"></span>å…³äºè‰¾å› <!----></a></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>ç”Ÿæ´»ä½“éªŒ</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E8%89%BE%E5%9B%A0/%E7%94%9F%E6%B4%BB%E4%BD%93%E9%AA%8C/%E4%B8%8A%E6%B5%B7.html" class="nav-link" aria-label="ä¸Šæµ·"><span class="icon iconfont icon-edit"></span>ä¸Šæµ·<!----></a></li><li class="dropdown-subitem"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E8%89%BE%E5%9B%A0/%E7%94%9F%E6%B4%BB%E4%BD%93%E9%AA%8C/%E6%9D%AD%E5%B7%9E.html" class="nav-link" aria-label="æ­å·"><span class="icon iconfont icon-edit"></span>æ­å·<!----></a></li><li class="dropdown-subitem"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E8%89%BE%E5%9B%A0/%E7%94%9F%E6%B4%BB%E4%BD%93%E9%AA%8C/%E5%AE%89%E5%90%89.html" class="nav-link" aria-label="å®‰å‰"><span class="icon iconfont icon-edit"></span>å®‰å‰<!----></a></li><li class="dropdown-subitem"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E8%89%BE%E5%9B%A0/%E7%94%9F%E6%B4%BB%E4%BD%93%E9%AA%8C/%E5%A4%A7%E7%90%86.html" class="nav-link" aria-label="å¤§ç†"><span class="icon iconfont icon-edit"></span>å¤§ç†<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>å…³äºå¨å¸ˆ</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E8%89%BE%E5%9B%A0/%E5%85%B3%E4%BA%8E%E5%8E%A8%E5%B8%88/%E8%89%BE%E5%9B%A0%E5%AE%B6%E7%9A%84%E8%8F%9C%E8%B0%B1.html" class="nav-link" aria-label="è‰¾å› å®¶çš„èœè°±"><span class="icon iconfont icon-edit"></span>è‰¾å› å®¶çš„èœè°±<!----></a></li><li class="dropdown-subitem"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E8%89%BE%E5%9B%A0/%E5%85%B3%E4%BA%8E%E5%8E%A8%E5%B8%88/%E8%89%BE%E5%9B%A0%E5%AE%B6%E7%9A%84%E7%94%9C%E5%93%81.html" class="nav-link" aria-label="è‰¾å› å®¶çš„ç”œå“"><span class="icon iconfont icon-edit"></span>è‰¾å› å®¶çš„ç”œå“<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>è§†é‡</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/zh/posts/å…³äºè‰¾å› /è§†é‡/1" class="nav-link" aria-label="tobeContinue"><span class="icon iconfont icon-edit"></span>tobeContinue<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="é¡¹ç›®"><span class="title"><span class="icon iconfont icon-edit"></span>é¡¹ç›®</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/zh/posts/%E9%A1%B9%E7%9B%AE%E7%9B%B8%E5%85%B3/%E9%A3%8E%E6%8E%A7%E5%86%B3%E7%AD%96%E5%BC%95%E6%93%8E.html" class="nav-link" aria-label="é£æ§å†³ç­–å¼•æ“ç›¸å…³"><span class="icon iconfont icon-edit"></span>é£æ§å†³ç­–å¼•æ“ç›¸å…³<!----></a></li><li class="dropdown-item"><a href="/zh/posts/%E9%A1%B9%E7%9B%AE%E7%9B%B8%E5%85%B3/FreeBe%E7%9B%B8%E5%85%B3.html" class="nav-link" aria-label="FreeBeç›¸å…³"><span class="icon iconfont icon-edit"></span>FreeBeç›¸å…³<!----></a></li><li class="dropdown-item"><a href="/zh/posts/%E9%A1%B9%E7%9B%AE%E7%9B%B8%E5%85%B3/%E4%B8%AA%E4%BA%BA%E4%B8%BB%E9%A1%B5%E5%8F%8A%E5%8D%9A%E5%AE%A2.html" class="nav-link" aria-label="ä¸ªäººä¸»é¡µåŠåšå®¢"><span class="icon iconfont icon-edit"></span>ä¸ªäººä¸»é¡µåŠåšå®¢<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æŠ€æœ¯"><span class="title"><span class="icon iconfont icon-edit"></span>æŠ€æœ¯</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>é¢˜è§£</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E6%8A%80%E6%9C%AF/LeetCode%E9%A2%98%E8%A7%A3/LeetCode%E9%A2%98%E8%A7%A3.html" class="nav-link" aria-label="LeetCodeé¢˜è§£"><span class="icon iconfont icon-edit"></span>LeetCodeé¢˜è§£<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>ç®—æ³•</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E6%8A%80%E6%9C%AF/%E7%AE%97%E6%B3%95/%E5%9B%BE%E8%AE%BA%E6%95%B4%E7%90%86.html" class="nav-link" aria-label="å›¾è®ºæ•´ç†"><span class="icon iconfont icon-edit"></span>å›¾è®ºæ•´ç†<!----></a></li><li class="dropdown-subitem"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E6%8A%80%E6%9C%AF/%E7%AE%97%E6%B3%95/%E4%BA%8C%E5%88%86%E6%90%9C%E7%B4%A2%E8%BE%B9%E7%95%8C%E5%88%A4%E6%96%AD.html" class="nav-link" aria-label="äºŒåˆ†æœç´¢è¾¹ç•Œåˆ¤æ–­"><span class="icon iconfont icon-edit"></span>äºŒåˆ†æœç´¢è¾¹ç•Œåˆ¤æ–­<!----></a></li><li class="dropdown-subitem"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E6%8A%80%E6%9C%AF/%E7%AE%97%E6%B3%95/%E5%B9%B6%E6%9F%A5%E9%9B%86.html" class="nav-link" aria-label="å¹¶æŸ¥é›†"><span class="icon iconfont icon-edit"></span>å¹¶æŸ¥é›†<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>åç«¯</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E6%8A%80%E6%9C%AF/%E5%90%8E%E7%AB%AF/java%E5%9F%BA%E7%A1%80.html" class="nav-link" aria-label="javaåŸºç¡€"><span class="icon iconfont icon-edit"></span>javaåŸºç¡€<!----></a></li><li class="dropdown-subitem"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E6%8A%80%E6%9C%AF/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93.html" class="nav-link" aria-label="æ•°æ®åº“"><span class="icon iconfont icon-edit"></span>æ•°æ®åº“<!----></a></li><li class="dropdown-subitem"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E6%8A%80%E6%9C%AF/%E5%90%8E%E7%AB%AF/redis.html" class="nav-link" aria-label="redis"><span class="icon iconfont icon-edit"></span>redis<!----></a></li><li class="dropdown-subitem"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E6%8A%80%E6%9C%AF/%E5%90%8E%E7%AB%AF/%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6.html" class="nav-link" aria-label="å¼€å‘æ¡†æ¶"><span class="icon iconfont icon-edit"></span>å¼€å‘æ¡†æ¶<!----></a></li><li class="dropdown-subitem"><a href="/zh/posts/%E5%85%B3%E4%BA%8E%E6%8A%80%E6%9C%AF/%E5%90%8E%E7%AB%AF/%E7%9F%A5%E8%AF%86%E9%93%BE%E6%8E%A5.html" class="nav-link" aria-label="çŸ¥è¯†é“¾æ¥"><span class="icon iconfont icon-edit"></span>çŸ¥è¯†é“¾æ¥<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æ–‡ç« ç¿»è¯‘"><span class="title"><span class="icon iconfont icon-edit"></span>æ–‡ç« ç¿»è¯‘</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E6%A8%A1%E5%BC%8F%E8%AE%BE%E8%AE%A1.html" class="nav-link" aria-label="K8sæ¨¡å¼"><span class="icon iconfont icon-edit"></span>K8sæ¨¡å¼<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/about/About.html" class="nav-link" aria-label="å…³äº"><span class="icon iconfont icon-discover"></span>å…³äº<!----></a></div></nav><div class="nav-item"><a class="repo-link" href="https://github.com/Aiyin5/Aiyin5.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!----><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/" class="nav-link sidebar-link sidebar-page" aria-label="ä¸»é¡µ"><span class="icon iconfont icon-home"></span>ä¸»é¡µ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><p class="sidebar-heading active"><span class="icon iconfont icon-note"></span><span class="title">æ–‡ç« </span><!----></p><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">å…³äºæŠ€æœ¯</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">å…³äºè‰¾å› </span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">æ–‡ç« ç¿»è¯‘</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">K8sæ¨¡å¼</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E6%A8%A1%E5%BC%8F%E8%AE%BE%E8%AE%A1.html" class="nav-link sidebar-link sidebar-page" aria-label="K8sæ¨¡å¼ç¿»è¯‘"><span class="icon iconfont icon-page"></span>K8sæ¨¡å¼ç¿»è¯‘<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">K8såŸºç¡€æ¨¡å¼</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F.html" class="nav-link sidebar-link sidebar-page" aria-label="ç¬¬äºŒç«  åŸºç¡€æ¨¡å¼"><span class="icon iconfont icon-page"></span>ç¬¬äºŒç«  åŸºç¡€æ¨¡å¼<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E5%8F%AF%E9%A2%84%E6%B5%8B%E7%9A%84%E9%9C%80%E6%B1%82.html" class="nav-link sidebar-link sidebar-page" aria-label="åŸºç¡€æ¨¡å¼-å¯é¢„æµ‹çš„éœ€æ±‚"><span class="icon iconfont icon-page"></span>åŸºç¡€æ¨¡å¼-å¯é¢„æµ‹çš„éœ€æ±‚<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E5%A3%B0%E6%98%8E%E6%80%A7%E9%83%A8%E7%BD%B2.html" class="nav-link sidebar-link sidebar-page" aria-label="åŸºç¡€æ¨¡å¼ å£°æ˜å¼éƒ¨ç½²"><span class="icon iconfont icon-page"></span>åŸºç¡€æ¨¡å¼ å£°æ˜å¼éƒ¨ç½²<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E5%81%A5%E5%BA%B7%E6%8E%A2%E9%92%88.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="åŸºç¡€æ¨¡å¼ å¥åº·æ¢é’ˆ"><span class="icon iconfont icon-page"></span>åŸºç¡€æ¨¡å¼ å¥åº·æ¢é’ˆ<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E5%81%A5%E5%BA%B7%E6%8E%A2%E9%92%88.html#_2-3-health-probe" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.3 Health Probe"><!---->2.3 Health Probe<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E5%81%A5%E5%BA%B7%E6%8E%A2%E9%92%88.html#_2-3-å¥åº·æ¢é’ˆ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.3 å¥åº·æ¢é’ˆ"><!---->2.3 å¥åº·æ¢é’ˆ<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E5%81%A5%E5%BA%B7%E6%8E%A2%E9%92%88.html#_2-3-1-problem" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.3.1 Problem"><!---->2.3.1 Problem<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E5%81%A5%E5%BA%B7%E6%8E%A2%E9%92%88.html#_2-3-1-é—®é¢˜" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.3.1 é—®é¢˜"><!---->2.3.1 é—®é¢˜<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E5%81%A5%E5%BA%B7%E6%8E%A2%E9%92%88.html#_2-3-2-solution" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.3.2 Solution"><!---->2.3.2 Solution<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E5%81%A5%E5%BA%B7%E6%8E%A2%E9%92%88.html#_2-3-2-è§£å†³æ–¹æ¡ˆ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.3.2 è§£å†³æ–¹æ¡ˆ"><!---->2.3.2 è§£å†³æ–¹æ¡ˆ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E5%81%A5%E5%BA%B7%E6%8E%A2%E9%92%88.html#_2-3-3-discussion" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.3.3 Discussion"><!---->2.3.3 Discussion<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E5%81%A5%E5%BA%B7%E6%8E%A2%E9%92%88.html#_2-3-3-è®¨è®º" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.3.3 è®¨è®º"><!---->2.3.3 è®¨è®º<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E6%89%98%E7%AE%A1%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html" class="nav-link sidebar-link sidebar-page" aria-label="åŸºç¡€æ¨¡å¼ æ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸ"><span class="icon iconfont icon-page"></span>åŸºç¡€æ¨¡å¼ æ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B8%83%E5%B1%80%EF%BC%88Pod%E7%9A%84%E6%94%BE%E7%BD%AE%EF%BC%89.html" class="nav-link sidebar-link sidebar-page" aria-label="åŸºç¡€æ¨¡å¼ è‡ªåŠ¨åŒ–å¸ƒå±€"><span class="icon iconfont icon-page"></span>åŸºç¡€æ¨¡å¼ è‡ªåŠ¨åŒ–å¸ƒå±€<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">K8sçš„ç®€ä»‹</span><span class="arrow right"></span></button><!----></section></li></ul></section></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">é¡¹ç›®ç›¸å…³</span><span class="arrow right"></span></button><!----></section></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><span class="icon iconfont icon-page"></span>åŸºç¡€æ¨¡å¼ å¥åº·æ¢é’ˆ</h1><div class="page-info"><span class="author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="http://www.aiyin.xyz" target="_blank" rel="noopener noreferrer">è‰¾å› </a></span><span property="author" content="è‰¾å› "></span></span><!----><span class="date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-01-05T00:00:00.000Z"></span><span class="category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><span class="category-item category4 clickable" role="navigation">æŠ€æœ¯</span><span class="category-item category2 clickable" role="navigation">K8s</span><meta property="articleSection" content="æŠ€æœ¯,K8s"></span><span class="tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><span class="tag-item tag-item1 clickable" role="navigation">ç¿»è¯‘</span><meta property="keywords" content="ç¿»è¯‘"></span><span class="reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 14 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT14M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E5%81%A5%E5%BA%B7%E6%8E%A2%E9%92%88.html#_2-3-health-probe" class="router-link-active router-link-exact-active toc-link level2">2.3 Health Probe</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E5%81%A5%E5%BA%B7%E6%8E%A2%E9%92%88.html#_2-3-å¥åº·æ¢é’ˆ" class="router-link-active router-link-exact-active toc-link level2">2.3 å¥åº·æ¢é’ˆ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E5%81%A5%E5%BA%B7%E6%8E%A2%E9%92%88.html#_2-3-1-problem" class="router-link-active router-link-exact-active toc-link level3">2.3.1 Problem</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E5%81%A5%E5%BA%B7%E6%8E%A2%E9%92%88.html#_2-3-1-é—®é¢˜" class="router-link-active router-link-exact-active toc-link level3">2.3.1 é—®é¢˜</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E5%81%A5%E5%BA%B7%E6%8E%A2%E9%92%88.html#_2-3-2-solution" class="router-link-active router-link-exact-active toc-link level3">2.3.2 Solution</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E5%81%A5%E5%BA%B7%E6%8E%A2%E9%92%88.html#_2-3-2-è§£å†³æ–¹æ¡ˆ" class="router-link-active router-link-exact-active toc-link level3">2.3.2 è§£å†³æ–¹æ¡ˆ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E5%81%A5%E5%BA%B7%E6%8E%A2%E9%92%88.html#_2-3-3-discussion" class="router-link-active router-link-exact-active toc-link level3">2.3.3 Discussion</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E5%81%A5%E5%BA%B7%E6%8E%A2%E9%92%88.html#_2-3-3-è®¨è®º" class="router-link-active router-link-exact-active toc-link level3">2.3.3 è®¨è®º</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="åŸºç¡€æ¨¡å¼-å¥åº·æ¢é’ˆ" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¨¡å¼-å¥åº·æ¢é’ˆ" aria-hidden="true">#</a> åŸºç¡€æ¨¡å¼ å¥åº·æ¢é’ˆ</h1><h2 id="_2-3-health-probe" tabindex="-1"><a class="header-anchor" href="#_2-3-health-probe" aria-hidden="true">#</a> 2.3 Health Probe</h2><h2 id="_2-3-å¥åº·æ¢é’ˆ" tabindex="-1"><a class="header-anchor" href="#_2-3-å¥åº·æ¢é’ˆ" aria-hidden="true">#</a> 2.3 å¥åº·æ¢é’ˆ</h2><p>The Health Probe pattern is about how an application can communicate its health state to Kubernetes. To be fully automatable, a cloud-native application must be highly observable by allowing its state to be inferred so that Kubernetes can detect whether the application is up and whether it is ready to serve requests. These observations influence the lifecycle management of Pods and the way traffic is routed to the application.</p><p>Health Probeæ¨¡å¼æ˜¯å…³äºåº”ç”¨ç¨‹åºå¦‚ä½•å°†å…¶å¥åº·çŠ¶æ€ä¼ é€’ç»™Kubernetesçš„ã€‚ä¸ºäº†å®Œå…¨è‡ªåŠ¨åŒ–ï¼Œäº‘åŸç”Ÿåº”ç”¨ç¨‹åºå¿…é¡»å…·æœ‰é«˜åº¦çš„å¯è§‚å¯Ÿæ€§ï¼Œå…è®¸æ¨æ–­å…¶çŠ¶æ€ï¼Œä»¥ä¾¿Kubernetesèƒ½å¤Ÿæ£€æµ‹åº”ç”¨ç¨‹åºæ˜¯å¦å·²å¯åŠ¨ä»¥åŠæ˜¯å¦å·²å‡†å¤‡å¥½ä¸ºè¯·æ±‚æä¾›æœåŠ¡ã€‚è¿™äº›è§‚å¯Ÿç»“æœä¼šå½±å“PODçš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ä»¥åŠå°†æµé‡è·¯ç”±åˆ°åº”ç”¨ç¨‹åºçš„æ–¹å¼ã€‚</p><h3 id="_2-3-1-problem" tabindex="-1"><a class="header-anchor" href="#_2-3-1-problem" aria-hidden="true">#</a> 2.3.1 Problem</h3><h3 id="_2-3-1-é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_2-3-1-é—®é¢˜" aria-hidden="true">#</a> 2.3.1 é—®é¢˜</h3><p>Kubernetes regularly checks the container process status and restarts it if issues are detected. However, from practice, we know that checking the process status is not sufficient to decide about the health of an application. In many cases, an application hangs, but its process is still up and running. For example, a Java application may throw an OutOfMemoryError and still have the JVM process running. Alternatively, an application may freeze because it runs into an infinite loop, deadlock, or some thrashing (cache, heap, process). To detect these kinds of situations, Kubernetes needs a reliable way to check the health of applications. That is, not to understand how an application works internally, but a check that indicates whether the application is functioning as expected and capable of serving consumers.</p><p>Kuberneteså®šæœŸæ£€æŸ¥å®¹å™¨è¿›ç¨‹çŠ¶æ€ï¼Œå¹¶åœ¨æ£€æµ‹åˆ°é—®é¢˜æ—¶é‡æ–°å¯åŠ¨ã€‚ç„¶è€Œï¼Œä»å®è·µä¸­æˆ‘ä»¬çŸ¥é“ï¼Œæ£€æŸ¥è¿›ç¨‹çŠ¶æ€ä¸è¶³ä»¥å†³å®šåº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶å†µã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œåº”ç”¨ç¨‹åºæŒ‚èµ·ï¼Œä½†å…¶è¿›ç¨‹ä»åœ¨è¿è¡Œã€‚ä¾‹å¦‚ï¼ŒJavaåº”ç”¨ç¨‹åºå¯èƒ½æŠ›å‡ºOutOfMemoryErrorï¼Œå¹¶ä¸”JVMè¿›ç¨‹ä»åœ¨è¿è¡Œã€‚æˆ–è€…ï¼Œåº”ç”¨ç¨‹åºå¯èƒ½ä¼šå†»ç»“ï¼Œå› ä¸ºå®ƒè¿è¡Œåœ¨æ— é™å¾ªç¯ã€æ­»é”æˆ–æŸäº›æŒ¯è¡ï¼ˆç¼“å­˜ã€å †ã€è¿›ç¨‹ï¼‰ä¸­ã€‚ä¸ºäº†æ£€æµ‹è¿™ç±»æƒ…å†µï¼ŒKuberneteséœ€è¦ä¸€ç§å¯é çš„æ–¹æ³•æ¥æ£€æŸ¥åº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶å†µã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸æ˜¯ä¸ºäº†äº†è§£åº”ç”¨ç¨‹åºåœ¨å†…éƒ¨æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè€Œæ˜¯ä¸ºäº†æ£€æŸ¥åº”ç”¨ç¨‹åºæ˜¯å¦æŒ‰é¢„æœŸè¿è¡Œå¹¶èƒ½å¤Ÿä¸ºæ¶ˆè´¹è€…æœåŠ¡ã€‚</p><h3 id="_2-3-2-solution" tabindex="-1"><a class="header-anchor" href="#_2-3-2-solution" aria-hidden="true">#</a> 2.3.2 Solution</h3><h3 id="_2-3-2-è§£å†³æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#_2-3-2-è§£å†³æ–¹æ¡ˆ" aria-hidden="true">#</a> 2.3.2 è§£å†³æ–¹æ¡ˆ</h3><p>The software industry has accepted the fact that it is not possible to write bug-free code. Moreover, the chances for failure increase even more when working with distributed applications. As a result, the focus for dealing with failures has shifted from avoiding them to detecting faults and recovering. Detecting failure is not a simple task that can be performed uniformly for all applications, as all have different definitions of a failure. Also, various types of failures require different corrective actions.Transient failures may self-recover, given enough time, and some other failures may need a restart of the application. Letâ€™s see the checks Kubernetes uses to detect and correct failures.</p><p>è½¯ä»¶è¡Œä¸šå·²ç»æ¥å—äº†è¿™æ ·ä¸€ä¸ªäº‹å®ï¼Œå³ä¸å¯èƒ½ç¼–å†™æ²¡æœ‰bugçš„ä»£ç ã€‚æ­¤å¤–ï¼Œåœ¨ä½¿ç”¨åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºæ—¶ï¼Œå‡ºç°æ•…éšœçš„æœºä¼šä¼šå¢åŠ å¾—æ›´å¤šã€‚å› æ­¤ï¼Œå¤„ç†æ•…éšœçš„é‡ç‚¹å·²ä»é¿å…æ•…éšœè½¬ç§»åˆ°æ£€æµ‹æ•…éšœå’Œæ¢å¤ã€‚æ£€æµ‹æ•…éšœå¹¶ä¸æ˜¯ä¸€é¡¹å¯ä»¥å¯¹æ‰€æœ‰åº”ç”¨ç¨‹åºç»Ÿä¸€æ‰§è¡Œçš„ç®€å•ä»»åŠ¡ï¼Œå› ä¸ºæ‰€æœ‰åº”ç”¨ç¨‹åºéƒ½æœ‰ä¸åŒçš„æ•…éšœå®šä¹‰ã€‚æ­¤å¤–ï¼Œå„ç§ç±»å‹çš„æ•…éšœéœ€è¦ä¸åŒçš„çº æ­£æªæ–½ã€‚å¦‚æœæœ‰è¶³å¤Ÿçš„æ—¶é—´ï¼Œç¬æ—¶æ•…éšœå¯èƒ½ä¼šè‡ªæˆ‘æ¢å¤ï¼Œè€Œå…¶ä»–ä¸€äº›æ•…éšœå¯èƒ½éœ€è¦é‡æ–°å¯åŠ¨åº”ç”¨ç¨‹åºã€‚è®©æˆ‘ä»¬çœ‹çœ‹Kubernetesç”¨æ¥æ£€æµ‹å’Œçº æ­£æ•…éšœçš„æ£€æŸ¥ã€‚</p><h4 id="_2-3-2-1-process-health-checks" tabindex="-1"><a class="header-anchor" href="#_2-3-2-1-process-health-checks" aria-hidden="true">#</a> 2.3.2.1 Process Health Checks</h4><h4 id="_2-3-2-1-è¿›ç¨‹çŠ¶æ€æ£€æµ‹" tabindex="-1"><a class="header-anchor" href="#_2-3-2-1-è¿›ç¨‹çŠ¶æ€æ£€æµ‹" aria-hidden="true">#</a> 2.3.2.1 è¿›ç¨‹çŠ¶æ€æ£€æµ‹</h4><p>A process health check is the simplest health check the Kubelet constantly performs on the container processes. If the container processes are not running, the container is restarted. So even without any other health checks, the application becomes slightly more robust with this generic check. If your application is capable of detecting any kind of failure and shutting itself down, the process health check is all you need. However, for most cases that is not enough and other types of health checks are also necessary.</p><p>è¿›ç¨‹è¿è¡ŒçŠ¶å†µæ£€æŸ¥æ˜¯Kubeletç»å¸¸å¯¹å®¹å™¨è¿›ç¨‹æ‰§è¡Œçš„æœ€ç®€å•çš„è¿è¡ŒçŠ¶å†µæ£€æŸ¥ã€‚å¦‚æœå®¹å™¨è¿›ç¨‹æœªè¿è¡Œï¼Œåˆ™é‡æ–°å¯åŠ¨å®¹å™¨ã€‚å› æ­¤ï¼Œå³ä½¿æ²¡æœ‰ä»»ä½•å…¶ä»–å¥åº·æ£€æŸ¥ï¼Œåº”ç”¨ç¨‹åºä¹Ÿä¼šé€šè¿‡è¿™ç§é€šç”¨æ£€æŸ¥å˜å¾—æ›´åŠ å¥å£®ã€‚å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºèƒ½å¤Ÿæ£€æµ‹åˆ°ä»»ä½•ç±»å‹çš„æ•…éšœå¹¶è‡ªè¡Œå…³é—­ï¼Œé‚£ä¹ˆæ‚¨åªéœ€è¦è¿›è¡Œæµç¨‹å¥åº·æ£€æŸ¥ã€‚ç„¶è€Œï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™è¿˜ä¸å¤Ÿï¼Œè¿˜éœ€è¦è¿›è¡Œå…¶ä»–ç±»å‹çš„å¥åº·æ£€æŸ¥ã€‚</p><h4 id="_2-3-2-2-liveness-probes" tabindex="-1"><a class="header-anchor" href="#_2-3-2-2-liveness-probes" aria-hidden="true">#</a> 2.3.2.2 Liveness Probes</h4><h4 id="_2-3-2-2-å­˜æ´»æ¢é’ˆ" tabindex="-1"><a class="header-anchor" href="#_2-3-2-2-å­˜æ´»æ¢é’ˆ" aria-hidden="true">#</a> 2.3.2.2 å­˜æ´»æ¢é’ˆ</h4><p>If your application runs into some deadlock, it is still considered healthy from the process health checkâ€™s point of view. To detect this kind of issue and any other types of failure according to your application business logic, Kubernetes has liveness proberegular checks performed by the Kubelet agent that asks your container to confirm it is still healthy. It is important to have the health check performed from the outside rather than the in application itself, as some failures may prevent the application watchdog from reporting its failure. Regarding corrective action, this health check is similar to a process health check, since if a failure is detected, the container is restarted. However, it offers more flexibility regarding what methods to use for checking the application health, as follows:</p><p>å¦‚æœä½ çš„åº”ç”¨ç¨‹åºè¿è¡Œä¸­é‡åˆ°ä¸€äº›æ­»é”ï¼Œä»è¿›ç¨‹å¥åº·æ£€æŸ¥çš„è§’åº¦æ¥çœ‹ï¼Œå®ƒä»ç„¶è¢«è®¤ä¸ºæ˜¯æ­£å¸¸çš„ã€‚ä¸ºäº†æ£€æµ‹åˆ°è¿™ç±»é—®é¢˜ä»¥åŠç›¸ä¼¼çš„å…¶ä»–é€ æˆåº”ç”¨æµ‹åºä¸šåŠ¡é€»è¾‘å¤±æ•ˆçš„æƒ…å†µï¼ŒKubernetesæä¾›äº†ç”±Kubeletä»£ç†æ‰§è¡Œçš„æ´»åŠ¨å¸¸è§„æ£€æŸ¥ï¼Œè¯¥ä»£ç†ä¼šè¦æ±‚å®¹å™¨ç¡®è®¤å…¶æ˜¯å¦ä»ç„¶æ­£å¸¸ã€‚ä»å¤–éƒ¨è€Œä¸æ˜¯ä»åº”ç”¨ç¨‹åºæœ¬èº«æ‰§è¡Œè¿è¡ŒçŠ¶å†µæ£€æŸ¥éå¸¸é‡è¦ï¼Œå› ä¸ºæŸäº›æ•…éšœå¯èƒ½ä¼šé˜»æ­¢åº”ç”¨ç¨‹åºç›‘è§†ç¨‹åºæŠ¥å‘Šå…¶æ•…éšœã€‚å…³äºçº æ­£æªæ–½ï¼Œæ­¤å¥åº·æ£€æŸ¥ç±»ä¼¼äºè¿›ç¨‹å¥åº·æ£€æŸ¥ï¼Œå› ä¸ºå¦‚æœæ£€æµ‹åˆ°æ•…éšœï¼Œå®¹å™¨å°†é‡æ–°å¯åŠ¨ã€‚ä½†æ˜¯ï¼Œå®ƒåœ¨æ£€æŸ¥åº”ç”¨ç¨‹åºè¿è¡ŒçŠ¶å†µçš„æ–¹æ³•æ–¹é¢æä¾›äº†æ›´å¤§çš„çµæ´»æ€§ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><ul><li>HTTP probe performs an HTTP GET request to the container IP address and expects a successful HTTP response code between 200 and 399.</li><li>HTTP æ¢é’ˆå¯¹å®¹å™¨IPåœ°å€æ‰§è¡ŒHTTP GETè¯·æ±‚ï¼Œå¹¶æœŸæœ›æˆåŠŸçš„HTTPå“åº”ä»£ç ä»‹äº200å’Œ399ä¹‹é—´ã€‚</li><li>A TCP Socket probe assumes a successful TCP connection.</li><li>TCPå¥—æ¥å­—æ¢é’ˆå‡å®šTCPè¿æ¥æˆåŠŸã€‚</li><li>An Exec probe executes an arbitrary command in the container kernel namespace and expects a successful exit code (0).</li><li>æ‰§è¡Œæ¢é’ˆåœ¨å®¹å™¨å†…æ ¸å‘½åç©ºé—´ä¸­æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¹¶æœŸæœ›æˆåŠŸé€€å‡ºä»£ç ï¼ˆ0ï¼‰ã€‚</li></ul><p>An example HTTP-based liveness probe is shown in Example 4-1.</p><p>Example 4-1. Container with a liveness probe</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pod<span class="token punctuation">-</span>with<span class="token punctuation">-</span>liveness<span class="token punctuation">-</span>check
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> k8spatterns/random<span class="token punctuation">-</span>generator<span class="token punctuation">:</span><span class="token number">1.0</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> random<span class="token punctuation">-</span>generator
    <span class="token key atrule">env</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> DELAY_STARTUP
      <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&quot;20&quot;</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
    <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
      <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>     <span class="token comment">#HTTP probe to a health-check endpoint</span>
        <span class="token key atrule">path</span><span class="token punctuation">:</span> /actuator/health
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
      <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">30</span>
<span class="token comment">#Wait 30 seconds before doing the first liveness check to give the application some time to warm up</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Depending on the nature of your application, you can choose the method that is most suitable for you. It is up to your implementation to decide when your application is considered healthy or not. However, keep in mind that the result of not passing a health check is restarting of your container. If restarting your container does not help, there is no benefit to having a failing health check as Kubernetes restarts your container without fixing the underlying issue.</p><p>æ ¹æ®åº”ç”¨ç¨‹åºçš„æ€§è´¨ï¼Œä½ å¯ä»¥é€‰æ‹©æœ€é€‚åˆè‡ªå·±çš„æ–¹æ³•ã€‚ä»€ä¹ˆæ—¶å€™åº”ç”¨ç¨‹åºè¢«è®¤ä¸ºæ˜¯å¥åº·çš„ï¼Œè¿™å–å†³äºä½ çš„å®ç°ã€‚ä½†æ˜¯ï¼Œè¯·è®°ä½ï¼Œæœªé€šè¿‡è¿è¡ŒçŠ¶å†µæ£€æŸ¥çš„ç»“æœæ˜¯é‡æ–°å¯åŠ¨å®¹å™¨ã€‚å¦‚æœé‡æ–°å¯åŠ¨å®¹å™¨æ²¡æœ‰å¸®åŠ©ï¼Œé‚£ä¹ˆè¿è¡ŒçŠ¶å†µæ£€æŸ¥å¤±è´¥æ²¡æœ‰ä»»ä½•å¥½å¤„ï¼Œå› ä¸ºKubernetesåœ¨æ²¡æœ‰ä¿®å¤æ½œåœ¨é—®é¢˜çš„æƒ…å†µä¸‹é‡æ–°å¯åŠ¨å®¹å™¨ã€‚</p><h4 id="_2-3-2-3-readiness-probes" tabindex="-1"><a class="header-anchor" href="#_2-3-2-3-readiness-probes" aria-hidden="true">#</a> 2.3.2.3 Readiness Probes</h4><h4 id="_2-3-2-3-å°±ç»ªæ¢é’ˆ" tabindex="-1"><a class="header-anchor" href="#_2-3-2-3-å°±ç»ªæ¢é’ˆ" aria-hidden="true">#</a> 2.3.2.3 å°±ç»ªæ¢é’ˆ</h4><p>Liveness checks are useful for keeping applications healthy by killing unhealthy containers and replacing them with new ones. But sometimes a container may not be healthy, and restarting it may not help either. The most common example is when a container is still starting up and not ready to handle any requests yet. Or maybe a container is overloaded, and its latency is increasing, and you want it to shield itself from additional load for a while.</p><p>æ´»åŠ¨æ€§æ¢é’ˆæœ‰åŠ©äºé€šè¿‡æ¶ˆé™¤ä¸å¥åº·çš„å®¹å™¨å¹¶ç”¨æ–°å®¹å™¨æ›¿æ¢å®ƒä»¬æ¥ä¿æŒåº”ç”¨ç¨‹åºçš„å¥åº·ã€‚ä½†æœ‰æ—¶å®¹å™¨å¯èƒ½ä¸å¥åº·ï¼Œé‡æ–°å¯åŠ¨ä¹Ÿå¯èƒ½æ— æµäºäº‹ã€‚æœ€å¸¸è§çš„ä¾‹å­æ˜¯å½“å®¹å™¨ä»åœ¨å¯åŠ¨ä¸”å°šæœªå‡†å¤‡å¥½å¤„ç†ä»»ä½•è¯·æ±‚æ—¶ã€‚æˆ–è€…ä¸€ä¸ªå®¹å™¨è¿‡è½½äº†ï¼Œå®ƒçš„å»¶è¿Ÿåœ¨å¢åŠ ï¼Œä½ å¸Œæœ›å®ƒåœ¨ä¸€æ®µæ—¶é—´å†…é¿å…é¢å¤–çš„è´Ÿè½½ã€‚</p><p>For this kind of scenario, Kubernetes has readiness probes. The methods for performing readiness checks are the same as liveness checks (HTTP, TCP, Exec), but the corrective action is different. Rather than restarting the container, a failed readiness probe causes the container to be removed from the service endpoint and not receive any new traffic. Readiness probes signal when a container is ready so that it has some time to warm up before getting hit with requests from the service. It is also useful for shielding the container from traffic at later stages, as readiness probes are performed regularly, similarly to liveness checks. Example 4-2 shows how a readiness probe can be implemented by probing the existence of a file the application creates when it is ready for operations.</p><p>å¯¹äºè¿™ç§æƒ…å†µï¼ŒKubernetesæä¾›äº†å°±ç»ªæ¢é’ˆã€‚æ‰§è¡Œå°±ç»ªæ€§æ£€æŸ¥çš„æ–¹æ³•ä¸æ´»åŠ¨æ€§æ£€æŸ¥ï¼ˆHTTPã€TCPã€Execï¼‰ç›¸åŒï¼Œä½†çº æ­£æªæ–½ä¸åŒã€‚å¤±è´¥çš„å°±ç»ªæ€§æ¢æµ‹ä¸ä¼šé‡æ–°å¯åŠ¨å®¹å™¨ï¼Œè€Œæ˜¯å¯¼è‡´å®¹å™¨ä»æœåŠ¡ç«¯ç‚¹ç§»é™¤ï¼Œå¹¶ä¸”ä¸ä¼šæ¥æ”¶ä»»ä½•æ–°æµé‡ã€‚å°±ç»ªæ¢é’ˆåœ¨å®¹å™¨å‡†å¤‡å°±ç»ªæ—¶å‘å‡ºä¿¡å·ï¼Œä»¥ä¾¿åœ¨æ”¶åˆ°æ¥è‡ªæœåŠ¡çš„è¯·æ±‚ä¹‹å‰æœ‰æ—¶é—´é¢„çƒ­ã€‚å®ƒè¿˜å¯ç”¨äºåœ¨åæœŸä¿æŠ¤å®¹å™¨ä¸å—æµé‡å½±å“ï¼Œå› ä¸ºå°±ç»ªæ¢é’ˆæ˜¯å®šæœŸæ‰§è¡Œçš„ï¼Œç±»ä¼¼äºæ´»åŠ¨æ€§æ£€æŸ¥ã€‚ç¤ºä¾‹4-2æ˜¾ç¤ºäº†å¦‚ä½•é€šè¿‡æ¢æµ‹åº”ç”¨ç¨‹åºåœ¨å‡†å¤‡è¿è¡Œæ—¶åˆ›å»ºçš„æ–‡ä»¶çš„å­˜åœ¨æ€§æ¥å®ç°å°±ç»ªæ¢æµ‹ã€‚</p><p>Example 4-2. Container with readiness probe</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pod<span class="token punctuation">-</span>with<span class="token punctuation">-</span>readiness<span class="token punctuation">-</span>check
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> k8spatterns/random<span class="token punctuation">-</span>generator<span class="token punctuation">:</span><span class="token number">1.0</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> random<span class="token punctuation">-</span>generator
    <span class="token key atrule">readinessProbe</span><span class="token punctuation">:</span>
      <span class="token key atrule">exec</span><span class="token punctuation">:</span>
        <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;stat&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/var/run/random-generator-ready&quot;</span> <span class="token punctuation">]</span>
<span class="token comment">#Check for the existence of a file the application creates to indicate itâ€™s ready to serve requests. stat returns an error if the file does not exist, letting the readiness check fail.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Again, it is up to your implementation of the health check to decide when your application is ready to do its job and when it should be left alone. While process health checks and liveness checks are intended to recover from the failure by restarting the container, the readiness check buys time for your application and expects it to recover by itself. Keep in mind that Kubernetes tries to prevent your container from receiving new requests (when it is shutting down, for example), regardless of whether the readiness check still passes after having received a SIGTERM signal.</p><p>åŒæ ·ï¼Œå¥åº·æ£€æŸ¥å®ç°æ¥å†³å®šåº”ç”¨ç¨‹åºä½•æ—¶å‡†å¤‡å¥½å®Œæˆå…¶å·¥ä½œä»¥åŠä½•æ—¶åº”è¯¥è®©å®ƒå•ç‹¬è¿è¡Œã€‚è™½ç„¶è¿›ç¨‹è¿è¡ŒçŠ¶å†µæ£€æŸ¥å’Œæ´»åŠ¨æ€§æ£€æŸ¥æ—¨åœ¨é€šè¿‡é‡æ–°å¯åŠ¨å®¹å™¨ä»æ•…éšœä¸­æ¢å¤ï¼Œä½†å°±ç»ªæ€§æ£€æŸ¥ä¸ºåº”ç”¨ç¨‹åºèµ¢å¾—äº†æ—¶é—´ï¼Œå¹¶æœŸæœ›å®ƒèƒ½å¤Ÿè‡ªè¡Œæ¢å¤ã€‚è¯·è®°ä½ï¼ŒKubernetesè¯•å›¾é˜»æ­¢å®¹å™¨æ¥æ”¶æ–°è¯·æ±‚ï¼ˆä¾‹å¦‚ï¼Œå½“å®ƒå…³é—­æ—¶ï¼‰ï¼Œè€Œä¸ç®¡åœ¨æ¥æ”¶åˆ°SIGTERMä¿¡å·åå°±ç»ªæ€§æ£€æŸ¥æ˜¯å¦ä»ç„¶é€šè¿‡ã€‚</p><p>In many cases, you have liveness and readiness probes performing the same checks.However, the presence of a readiness probe gives your container time to start up.Only by passing the readiness check is a Deployment considered to be successful, so that, for example, Pods with an older version can be terminated as part of a rolling update.</p><p>åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œæ´»åŠ¨æ€§å’Œå°±ç»ªæ€§æ¢é’ˆæ‰§è¡Œç›¸åŒçš„æ£€æŸ¥ã€‚ä½†æ˜¯ï¼Œå°±ç»ªæ¢é’ˆçš„å­˜åœ¨ä¸ºå®¹å™¨æä¾›äº†å¯åŠ¨æ—¶é—´ã€‚åªæœ‰é€šè¿‡å°±ç»ªæ€§æ£€æŸ¥ï¼Œéƒ¨ç½²æ‰ä¼šè¢«è§†ä¸ºæˆåŠŸï¼Œå› æ­¤ï¼Œä¾‹å¦‚ï¼Œå…·æœ‰è¾ƒæ—§ç‰ˆæœ¬çš„PODå¯ä»¥ä½œä¸ºæ»šåŠ¨æ›´æ–°çš„ä¸€éƒ¨åˆ†ç»ˆæ­¢ã€‚</p><p>The liveness and readiness probes are fundamental building blocks in the automation of cloud-native applications. Application frameworks such as Spring actuator, WildFly Swarm health check, Karaf health checks, or the MicroProfile spec for Java provide implementations for offering Health Probes.</p><p>å­˜æ´»æ¢é’ˆå’Œå°±ç»ªæ¢é’ˆæ˜¯äº‘åŸç”Ÿåº”ç”¨ç¨‹åºè‡ªåŠ¨åŒ–çš„åŸºæœ¬æ„å»ºå—ã€‚Spring actuatorã€WildFly Swarm health checkã€Karaf health checksæˆ–MicroProfile spec for Javaç­‰åº”ç”¨ç¨‹åºæ¡†æ¶æä¾›äº†æä¾›å¥åº·æ¢é’ˆçš„å®ç°ã€‚</p><h3 id="_2-3-3-discussion" tabindex="-1"><a class="header-anchor" href="#_2-3-3-discussion" aria-hidden="true">#</a> 2.3.3 Discussion</h3><h3 id="_2-3-3-è®¨è®º" tabindex="-1"><a class="header-anchor" href="#_2-3-3-è®¨è®º" aria-hidden="true">#</a> 2.3.3 è®¨è®º</h3><p>To be fully automatable, cloud-native applications must be highly observable by providing a means for the managing platform to read and interpret the application health, and if necessary, take corrective actions. Health checks play a fundamental role in the automation of activities such as deployment, self-healing, scaling, and others. However, there are also other means through which your application can provide more visibility about its health.</p><p>è¦å®ç°å®Œå…¨è‡ªåŠ¨åŒ–ï¼Œäº‘åŸç”Ÿåº”ç”¨ç¨‹åºå¿…é¡»å…·æœ‰é«˜åº¦çš„å¯è§‚å¯Ÿæ€§ï¼Œæ‰€ä»¥è¦ä¸ºç®¡ç†å¹³å°æä¾›ä¸€ç§è¯»å–å’Œè§£é‡Šåº”ç”¨ç¨‹åºè¿è¡ŒçŠ¶å†µçš„æ–¹æ³•ï¼Œå¹¶åœ¨å¿…è¦æ—¶é‡‡å–çº æ­£æªæ–½ã€‚è¿è¡ŒçŠ¶å†µæ£€æŸ¥åœ¨è‡ªåŠ¨åŒ–æ´»åŠ¨ï¼ˆå¦‚éƒ¨ç½²ã€è‡ªæˆ‘ä¿®å¤ã€æ‰©å±•ç­‰ï¼‰ä¸­èµ·ç€åŸºç¡€æ€§ä½œç”¨ã€‚ä½†æ˜¯ï¼Œåº”ç”¨ç¨‹åºè¿˜å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼æä¾›æœ‰å…³å…¶è¿è¡ŒçŠ¶å†µçš„æ›´å¤šå¯è§æ€§ã€‚</p><p>The obvious and old method for this purpose is through logging. It is a good practice for containers to log any significant events to system out and system error and have these logs collected to a central location for further analysis. Logs are not typically used for taking automated actions, but rather to raise alerts and further investigations.A more useful aspect of logs is the postmortem analysis of failures and detecting unnoticeable errors.</p><p>ä¸ºäº†è¾¾åˆ°è¿™ä¸€ç›®çš„ï¼Œæœ€æ˜æ˜¾ä¹Ÿæ˜¯æœ€å¤è€çš„æ–¹æ³•æ˜¯é€šè¿‡æ—¥å¿—ã€‚å®¹å™¨å°†ä»»ä½•é‡å¤§äº‹ä»¶è®°å½•åˆ°system outå’Œsystem errorä¸­ï¼Œå¹¶å°†è¿™äº›æ—¥å¿—æ”¶é›†åˆ°ä¸­å¿ƒä½ç½®ä»¥ä¾›è¿›ä¸€æ­¥åˆ†æï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åšæ³•ã€‚æ—¥å¿—é€šå¸¸ä¸ç”¨äºé‡‡å–è‡ªåŠ¨æ“ä½œï¼Œè€Œæ˜¯ç”¨äºå‘å‡ºè­¦æŠ¥å’Œè¿›ä¸€æ­¥è°ƒæŸ¥ã€‚æ—¥å¿—çš„ä¸€ä¸ªæ›´æœ‰ç”¨çš„æ–¹é¢æ˜¯å¯¹æ•…éšœè¿›è¡Œäº‹ååˆ†æå’Œæ£€æµ‹ä¸å¯è§çš„é”™è¯¯ã€‚</p><p>Apart from logging to standard streams, it is also a good practice to log the reason for exiting a container to /dev/termination-log. This location is the place where the container can state its last will before being permanently vanished. Figure 4-1 shows the possible options for how a container can communicate with the runtime platform.</p><p>é™¤äº†è®°å½•åˆ°æ ‡å‡†æµä¹‹å¤–ï¼Œå°†é€€å‡ºå®¹å™¨çš„åŸå› è®°å½•åˆ°/dev/termination logä¹Ÿæ˜¯ä¸€ç§å¾ˆå¥½çš„åšæ³•ã€‚è¿™ä¸ªä½ç½®æ˜¯å®¹å™¨åœ¨æ°¸ä¹…æ¶ˆå¤±ä¹‹å‰å¯ä»¥é™ˆè¿°å…¶æœ€åæ—¥å¿—çš„åœ°æ–¹ã€‚å›¾4-1æ˜¾ç¤ºäº†å®¹å™¨å¦‚ä½•ä¸è¿è¡Œæ—¶å¹³å°é€šä¿¡çš„å¯èƒ½é€‰é¡¹ã€‚</p><figure><img src="https://cdn.nlark.com/yuque/0/2021/png/2466332/1636027007912-51be3158-763b-4d36-a9f5-ed611dd59d49.png#clientId=u0f5de37c-8e26-4&amp;from=paste&amp;height=280&amp;id=u73c096aa&amp;margin=[object Object]&amp;name=image.png&amp;originHeight=280&amp;originWidth=903&amp;originalType=binary&amp;ratio=1&amp;size=41945&amp;status=done&amp;style=none&amp;taskId=ua5661e74-d714-41f2-b306-26d13021d1a&amp;width=903" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>Figure 4-1. Container observability options</p><p>Containers provide a unified way for packaging and running applications by treating them like black boxes. However, any container that is aiming to become a cloudnative citizen must provide APIs for the runtime environment to observe the container health and act accordingly. This support is a fundamental prerequisite for automation of the container updates and lifecycle in a unified way, which in turn improves the systemâ€™s resilience and user experience. In practical terms, that means, as a very minimum, your containerized application must provide APIs for the different kinds of health checks (liveness and readiness).</p><p>å®¹å™¨é€šè¿‡å°†åº”ç”¨ç¨‹åºè§†ä¸ºé»‘åŒ£å­æ¥æä¾›æ‰“åŒ…å’Œè¿è¡Œåº”ç”¨ç¨‹åºçš„ç»Ÿä¸€æ–¹å¼ã€‚ä½†æ˜¯ï¼Œä»»ä½•æ—¨åœ¨æˆä¸ºäº‘åŸç”Ÿå…¬æ°‘çš„å®¹å™¨éƒ½å¿…é¡»ä¸ºè¿è¡Œæ—¶ç¯å¢ƒæä¾›APIï¼Œä»¥è§‚å¯Ÿå®¹å™¨çš„è¿è¡ŒçŠ¶å†µå¹¶ç›¸åº”åœ°é‡‡å–è¡ŒåŠ¨ã€‚è¿™ç§æ”¯æŒæ˜¯ä»¥ç»Ÿä¸€çš„æ–¹å¼è‡ªåŠ¨åŒ–å®¹å™¨æ›´æ–°å’Œç”Ÿå‘½å‘¨æœŸçš„åŸºæœ¬å‰æï¼Œè¿™åè¿‡æ¥åˆæé«˜äº†ç³»ç»Ÿçš„å¼¹æ€§å’Œç”¨æˆ·ä½“éªŒã€‚å®é™…ä¸Šï¼Œè¿™æ„å‘³ç€ï¼Œå®¹å™¨åŒ–åº”ç”¨ç¨‹åºè‡³å°‘å¿…é¡»ä¸ºä¸åŒç±»å‹çš„å¥åº·æ£€æŸ¥ï¼ˆæ´»åŠ¨æ€§å’Œå°±ç»ªæ€§ï¼‰æä¾›APIã€‚</p><p>Even better-behaving applications must also provide other means for the managing platform to observe the state of the containerized application by integrating with tracing and metrics-gathering libraries such as OpenTracing or Prometheus. Treat your application as a black box, but implement all the necessary APIs to help the platform observe and manage your application in the best way possible.</p><p>å³ä½¿æ€§èƒ½æ›´å¥½çš„åº”ç”¨ç¨‹åºä¹Ÿå¿…é¡»ä¸ºç®¡ç†å¹³å°æä¾›å…¶ä»–æ‰‹æ®µï¼Œä»¥ä¾¿é€šè¿‡ä¸è·Ÿè¸ªå’Œåº¦é‡æ”¶é›†åº“ï¼ˆå¦‚OpenTracingæˆ–Prometheusï¼‰é›†æˆæ¥è§‚å¯Ÿå®¹å™¨åŒ–åº”ç”¨ç¨‹åºçš„çŠ¶æ€ã€‚å°†åº”ç”¨ç¨‹åºè§†ä¸ºä¸€ä¸ªé»‘ç›’å­ï¼Œä½†è¦å®ç°æ‰€æœ‰å¿…è¦çš„APIï¼Œä»¥å¸®åŠ©å¹³å°ä»¥æœ€ä½³æ–¹å¼è§‚å¯Ÿå’Œç®¡ç†åº”ç”¨ç¨‹åºã€‚</p><p>The next pattern, Managed Lifecycle, is also about communication between applications and the Kubernetes management layer, but coming from the other direction. Itâ€™s about how your application gets informed about important Pod lifecycle events.</p><p>ä¸‹ä¸€ä¸ªæ¨¡å¼ï¼Œæ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸï¼Œä¹Ÿæ˜¯å…³äºåº”ç”¨ç¨‹åºå’ŒKubernetesç®¡ç†å±‚ä¹‹é—´çš„é€šä¿¡ï¼Œä½†æ¥è‡ªå¦ä¸€ä¸ªæ–¹å‘ã€‚å®ƒæ˜¯å…³äºåº”ç”¨ç¨‹åºå¦‚ä½•è·å¾—æœ‰å…³é‡è¦Podç”Ÿå‘½å‘¨æœŸäº‹ä»¶çš„ä¿¡æ¯ã€‚</p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/Aiyin5/Aiyin5.github.io/edit/main/docs/zh/posts/æ–‡ç« ç¿»è¯‘/K8sæ¨¡å¼/K8såŸºç¡€æ¨¡å¼/å¥åº·æ¢é’ˆ.md" rel="noopener noreferrer" target="_blank" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="meta-item contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: 372020407@qq.com">aiyin</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E5%A3%B0%E6%98%8E%E6%80%A7%E9%83%A8%E7%BD%B2.html" class="nav-link prev" aria-label="åŸºç¡€æ¨¡å¼ å£°æ˜å¼éƒ¨ç½²"><div class="hint"><span class="arrow left"></span>ä¸Šä¸€é¡µ</div><div class="link"><span class="icon iconfont icon-page"></span>åŸºç¡€æ¨¡å¼ å£°æ˜å¼éƒ¨ç½²</div></a><a href="/zh/posts/%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91/K8s%E6%A8%A1%E5%BC%8F/K8s%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F/%E6%89%98%E7%AE%A1%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html" class="nav-link next" aria-label="åŸºç¡€æ¨¡å¼ æ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸ"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow right"></span></div><div class="link">åŸºç¡€æ¨¡å¼ æ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸ<span class="icon iconfont icon-page"></span></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer"><a href="/about/About">å…³äºç½‘ç«™</a></div><div class="copyright">Copyright Â© 2023 è‰¾å› </div></footer><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-28e805c5.js" defer></script>
  </body>
</html>
